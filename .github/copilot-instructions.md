# Copilot Instructions for Dawn of Stellar - Complete Game Documentation

<!-- Use this file to provide workspace-specific custom instructions to Copilot. For more details, visit https://code.visualstudio.com/docs/copilot/copilot-customization#_use-a-githubcopilot-instructions-md-file -->

## 🌟 Project Overview: Dawn of Stellar
**완전체 Python 기반 로그라이크 RPG 게임 + Flutter 모바일 클라이언트 - 2025년 8월 10일 최신 업데이트**

### 🎯 Core Game Vision
- **장르**: 클래식 로그라이크 + 현대적 JRPG 요소 융합 + FF 브레이브 시스템
- **스타일**: ASCII/유니코드 문자 기반 그래픽 + 실시간 게이지 애니메이션
- **플랫폼**: Windows/Linux/Mac 크로스 플랫폼 + Android/iOS 모바일
- **언어**: Python 3.10+ (완전 한국어 지원) + Flutter (다트)
- **테마**: 모험 + 판타지 세계관 + 차원간 모험
- **마스코트**: 로-바트 (자랑스럽고 장난기 있는 톤)

### 🏗️ Architecture
- **백엔드**: Python 기반 게임 엔진 서버
- **프론트엔드**: Flutter 모바일 앱 (터미널 스타일 UI)
- **통신**: HTTP REST API + 실시간 상태 동기화
- **저장**: JSON 기반 세이브 시스템 + 클라우드 동기화

## 📱 Mobile Client (Flutter)
### UI/UX Design
- **터미널 테마**: 레트로 ASCII 스타일 모바일 적응
- **제스처 컨트롤**: 스와이프 기반 이동 (방향키 대체)
- **컨트롤 패널**: DraggableScrollableSheet 기반
- **입력 버튼**: 1-9 숫자키 + 확인/취소 + ESC
- **디바운싱**: 버튼 자동 연타 방지
- **아이콘**: "@" 심볼 로고

### Key Mappings
- **확인**: Enter ("\n")
- **취소**: Q 키
- **ESC**: FloatingActionButton
- **이동**: 스와이프 제스처 (상하좌우)
- **숫자**: 1-9 버튼 (메뉴 선택)

### Technical Implementation
- **main.dart**: Flutter 앱 메인 엔트리
- **HTTP 클라이언트**: 백엔드 API 통신
- **RichText**: 컬러 텍스트 렌더링
- **ListView**: 스크롤 가능한 게임 출력
- **TextField**: 명령 입력

## 🎮 Complete Game Systems

### 1. 🏰 던전 시스템 (Dungeon System)
- **던전 생성**: 절차적 생성 알고리즘
- **던전 타입**: 일반, 특수, 보스, 히든 던전
- **층수 시스템**: 무한 층수 진행 (100층까지 구현)
- **미니맵**: 실시간 탐험 지도
- **함정 시스템**: 독, 폭발, 순간이동 함정
- **보물상자**: 일반, 마법, 전설 등급 상자
- **환경 상호작용**: 문, 레버, 비밀통로

### 2. ⚔️ 브레이브 전투 시스템 (Brave Combat System)
#### ATB (Active Time Battle) 시스템 - 2025.08.10 속도 조정
- **게이지 시스템**: 0~2000 범위 (ATB_MAX=2000)
- **행동 임계값**: 1000 (ATB_READY_THRESHOLD=1000)
- **속도 기반**: 캐릭터 속도에 따른 ATB 증가
- **증가량**: 기본 15 기반 (25→15로 감소) - 속도에 따라 7.5~30
- **행동 비용**: 행동 후 ATB 1000 차감
- **캐스팅 시스템**: 스킬별 시전 시간 + 중단 가능
- **공정성**: get_action_order()로 단일 우선순위 기반 선택

#### ATB 문제 해결 내역 (2025.08.10)
- **player_turn 수정**: 캐스팅 중이거나 행동하지 않은 경우 ATB 차감 방지
- **battle_loop 개선**: 실제 행동한 경우에만 action_cost=1000 차감
- **casting 완료**: 캐스팅 완료 시에만 cast_time만큼 ATB 차감
- **BREAK 처리**: BREAK 상태에서만 ATB 0 리셋
- **우선순위**: ATB 게이지 > 속도 > 랜덤 순으로 공정한 선택
- **속도 밸런스**: base_increase 25→15로 조정하여 게임 속도 적절히 조절

#### Brave Point 시스템 (FF 스타일)
- **BRV 축적**: Brave 공격으로 포인트 획득
- **HP 공격**: BRV 소모하여 실제 피해
- **BREAK 시스템**: BRV 0일 때 무력화 상태
- **INT BRV**: 턴 시작 시 기본 BRV 회복
- **BRV 보정**: 직업별/장비별 BRV 보너스

#### 상처 시스템 (Wound System)
- **상처 축적**: 받은 피해의 25%가 상처로 누적
- **최대 상처**: 최대 HP의 75%까지 제한
- **상처 치유**: 초과 회복의 25%로 상처 치료
- **영구 피해**: 상처는 전투 종료 후에도 지속

#### 통합 데미지 시스템 (Unified Damage System)
- **물리/마법 피해**: 방어력 계산 통합
- **크리티컬 시스템**: 직업별 크리티컬 보정
- **상성 시스템**: 직업간 상성 보너스/페널티
- **저항/약점**: 원소별 저항/약점 시스템

### 3. 👥 파티 관리 시스템 (Party Management)
- **파티 크기**: 최대 4명 구성
- **직업 시스템**: 28개 고유 직업 (2025년 업데이트)
- **동료 시스템**: NPC 동료 영입
- **AI 동료**: 자동 전투 AI 탑재
- **파티 밸런스**: 탱커, 딜러, 힐러, 서포터 역할 분담
- **협력 스킬**: 파티원 간 연계 공격

### 4. 🎓 직업 시스템 (Character Classes) - 28개 직업
#### 전투 직업군 (8개)
- **전사**: 적응형 방패 강타, 파괴의 일격
- **아크메이지**: 마력 파동, 마력 폭발
- **궁수**: 삼연사, 관통사격 + 지원사격 시스템
- **도적**: 독침, 암살 + 맹독 시스템
- **성기사**: 성스러운 타격, 심판의 빛
- **암흑기사**: 흡혈 베기, 흡혈 강타
- **몽크**: 연환 타격, 폭렬권 + 표식 시스템
- **바드**: 음파 공격, 영혼의 노래 + 사기 시스템

#### 마법 직업군 (10개)
- **네크로맨서**: 생명력 흡수, 영혼 흡수
- **용기사**: 화염 강타, 드래곤 브레스
- **검성**: 검기 베기, 일섬
- **정령술사**: 원소 탄환, 원소 융합
- **시간술사**: 시간 조작, 시간 정지
- **연금술사**: 화학 폭발, 대폭발 반응
- **차원술사**: 차원 균열, 차원 붕괴
- **마검사**: 마법검기, 마검 오의
- **기계공학자**: 레이저 사격, 메가 레이저 (수정됨)
- **무당**: 영혼 타격, 영혼 분리 (밸런스 수정)

#### 특수 직업군 (10개)
- **암살자**: 그림자 강타, 그림자 처형 + 그림자 시스템
- **해적**: 이도류 난타, 해적의 보물
- **사무라이**: 거합 베기, 무사도 비의
- **드루이드**: 자연의 분노, 자연의 심판
- **철학자**: 논리적 반박, 진리의 깨달음
- **검투사**: 투기장 기술, 검투장의 피날레
- **기사**: 창 돌격, 성스러운 돌격
- **신관**: 축복의 빛, 신의 심판
- **광전사**: 광폭화 난타, 최후의 광기

### 5. ✨ 스킬 시스템 (New Skill System) - 2025년 완전 개편
#### 스킬 타입
- **BRV_ATTACK**: Brave 포인트 획득 공격 (기본 공격)
- **HP_ATTACK**: 직접 HP 피해 공격 (기본 공격)
- **BRV_HP_ATTACK**: BRV 획득 + HP 피해 복합
- **ULTIMATE**: 궁극기 (높은 MP 소모)
- **SUPPORT**: 지원/회복 스킬
- **DEBUFF**: 적 약화 스킬

#### 스킬 데이터베이스 구조
```python
# 각 직업별 기본 공격 2개 (MP 0)
{"name": "기계타격", "mp_cost": 0, "type": SkillType.BRV_ATTACK}
{"name": "에너지방출", "mp_cost": 0, "type": SkillType.HP_ATTACK}

# 전술 스킬들 (MP 소모)
{"name": "자기장_조작", "mp_cost": 12, "type": SkillType.SUPPORT}
```

#### 캐스팅 시스템
- **캐스트 타임**: 스킬별 시전 시간 (0.5초~3초)
- **중단 가능**: 피해 받으면 캐스팅 중단
- **ATB 연동**: 캐스팅 중 ATB 게이지 표시
- **즉시 시전**: MP 0 기본 공격은 즉시 실행

#### 특수 스킬 시스템
- **기계공학자**: 장비 조작 스킬 (적용 범위 수정)
- **바드**: 음표 중첩 방지 시스템
- **무당**: 영혼 스킬 밸런스 조정
- **도적**: 맹독 시스템 + 독 촉진
- **궁수**: 조준 포인트 + 지원사격
- **암살자**: 그림자 시스템 연동

### 6. 🎒 인벤토리 & 아이템 시스템
#### 아이템 카테고리
- **소모품**: 회복 포션, 버프 아이템
- **장비**: 무기, 방어구, 액세서리
- **재료**: 제작 재료, 강화 석
- **귀중품**: 퀘스트 아이템, 수집품

#### 장비 시스템 (Equipment System) - 2025.08.10 수정
- **확장 장비 클래스**: Equipment 클래스 기반
- **내구도 시스템**: 사용에 따른 내구도 감소
- **특수 효과**: EquipmentEffect 클래스
- **세트 장비**: 세트 효과 시스템
- **원소 저항**: ElementType 기반 저항/약점
- **인벤토리 연동**: 장착/해제 시 인벤토리 자동 관리
- **중복 방지**: equip_item 메서드 단일화로 아이템 소실 방지

#### 제작 시스템 (Crafting)
- **요리 시스템**: 음식 제작으로 버프 효과
- **연금술**: 포션 및 특수 아이템 제작
- **강화 시스템**: 장비 강화 및 인챈트

### 7. 🧬 특성 시스템 (Trait System)
#### 특성 타입
- **패시브 특성**: 항상 활성화된 효과
- **액티브 특성**: 수동 발동 특성
- **전투 특성**: 전투 중 자동 발동
- **조건부 특성**: 특정 조건에서 발동

#### 특성 예시
- **동물 변신**: 늑대/곰/독수리 형태 변환
- **원소 친화**: 원소 마법 위력 증가
- **전투 광**: 체력 낮을수록 공격력 증가
- **치유술사**: 회복 효과 2배 증가

### 8. 🤖 AI 시스템 (AI Game Mode) - 2025.08.10 개선
#### AI 모드 검증 강화
- **기본값 안전**: 모든 AI 체크에서 기본값 False
- **false positive 방지**: 메인 모듈 체크 비활성화
- **명시적 비활성화**: 전투 시스템 생성 시 set_ai_game_mode(False) 호출
- **AI 매니저 연동**: ai_game_mode_manager._enabled 명시적 체크

#### AI 동료 시스템
- **자동 전투**: AI가 최적 행동 선택
- **전략적 판단**: 상황 분석 후 행동 결정
- **협력 플레이**: 플레이어와 협력 전술
- **학습 능력**: 플레이 패턴 학습 및 적응

#### AI 행동 패턴
- **공격**: 최적 타겟 선택 (직업별 전략)
- **스킬**: 상황별 스킬 사용 (MP 0 기본 공격 포함)
- **방어**: 위험 상황 시 방어
- **치료**: 아군 체력 관리
- **아이템**: 필요 시 아이템 사용
- **요청**: 플레이어에게 지시 요청

#### 전술적 AI 우선순위
- **emergency_heal**: 응급 치료 (HP 20% 이하)
- **support_heal**: 지원 치료 (파티 HP 60% 이하)
- **ultimate_attack**: 궁극기 사용 (MP 20 이상)
- **tactical_skill**: 전술 스킬 (MP 12 이상)
- **hp_attack**: HP 공격 (BRV 400 이상)
- **brv_attack**: BRV 공격 (기본 행동)

### 9. 🎵 오디오 시스템 (Audio System)
#### BGM 시스템
- **상황별 BGM**: 던전, 전투, 마을, 보스
- **동적 전환**: 상황에 따른 자연스러운 전환
- **루프 재생**: 끊김 없는 배경음악
- **BGMType enum**: DUNGEON, BATTLE, BOSS, VICTORY 등

#### SFX 시스템
- **전투음**: 공격, 스킬, 방어음
- **환경음**: 발걸음, 문 여는 소리
- **UI음**: 메뉴, 선택, 확인음
- **스킬별 SFX**: 각 스킬마다 고유 효과음

### 10. 💾 저장 시스템 (Save System)
#### 저장 데이터
- **캐릭터 진행도**: 레벨, 경험치, 스탯
- **인벤토리**: 아이템, 장비, 돈
- **던전 진행**: 탐험한 층수, 맵 정보
- **퀘스트**: 진행 중/완료된 퀘스트
- **설정**: 게임 설정, 키 바인딩

#### 자동 저장
- **던전 진입**: 새 층 진입 시 자동 저장
- **전투 승리**: 중요 전투 후 자동 저장
- **상점 이용**: 거래 완료 후 자동 저장

### 11. 🎯 난이도 시스템 (Difficulty System)
- **쉬움**: 초보자용 (피해 -30%, 경험치 +20%)
- **보통**: 표준 난이도
- **어려움**: 도전적 (피해 +50%, 경험치 +50%)
- **지옥**: 극한 도전 (피해 +100%, 특수 보상)

### 12. 🏆 업적 시스템 (Achievement System)
- **전투 업적**: 연속 승리, 완벽한 승리
- **탐험 업적**: 층수 도달, 비밀 발견
- **수집 업적**: 아이템 수집, 도감 완성
- **특수 업적**: 숨겨진 조건 달성

### 13. 🎮 UI/UX 시스템 (Interface Systems) - 2025.08.10 안정화
#### 애니메이션 시스템
- **게이지 애니메이션**: HP/MP/BRV/ATB 실시간 애니메이션
- **SequentialGaugeAnimator**: 순차적 게이지 처리
- **BufferedDisplay**: 화면 깜빡임 방지
- **부드러운 전환**: easeInOutQuad 곡선 적용

#### 입력 시스템
- **CursorMenu**: 커서 기반 메뉴 시스템
- **KeyboardInput**: 키보드 입력 처리
- **HotkeySystem**: 단축키 시스템
- **InputBuffer**: 입력 버퍼 관리

#### 표시 시스템
- **ColorSystem**: 256색 컬러 시스템
- **GameDisplay**: 게임 화면 렌더링
- **StatusDisplay**: 실시간 상태 표시
- **CombatVisualizer**: 전투 시각 효과
- **화면 깜빡임 방지**: clear_screen=False 적용으로 검정화면 문제 해결

### 14. 🛡️ 장비 관리 시스템 (Equipment Management)
#### AI 자동 장착 시스템
- **BasicEquipmentManager**: 자동 장비 최적화
- **안전한 장착**: 아이템 소실 방지 시스템
- **인벤토리 연동**: 장착/해제 시 인벤토리 동기화
- **보너스 적용**: 장비 효과 자동 계산

#### 장비 효과 시스템
- **스탯 보너스**: 기본 능력치 증가
- **특수 효과**: SpecialEffect enum 기반
- **세트 효과**: 같은 세트 장비 착용 시 추가 효과
- **내구도 관리**: 사용에 따른 내구도 감소 및 수리

### 15. 🌑 특수 메커니즘 시스템
#### 그림자 시스템 (암살자 전용)
- **그림자 생성**: 공격 시 그림자 소환
- **그림자 메아리**: 추가 피해 효과
- **그림자 처형**: 모든 그림자 소모 강력한 일격

#### 맹독 시스템 (도적 전용)
- **독 중첩**: 최대 96스택까지 독 누적
- **독 촉진**: HP 공격 시 독 피해 즉시 적용
- **독 면역**: 특정 조건에서 독 면역 획득

#### 조준 시스템 (궁수 전용)
- **조준 포인트**: 공격마다 조준 정확도 증가
- **지원사격**: 턴 종료 시 추가 공격
- **관통 공격**: 여러 적에게 동시 피해

### 16. 🗺️ 월드 상호작용 시스템 (World Interaction) - 2025.08.10 완전 개선
#### 맵 장치 상호작용
- **Enter키 상호작용**: 주변 객체와 대화형 상호작용
- **밟아서 작동**: 치유의 샘, 함정 등 자동 트리거
- **스킬 요구사항 표시**: 필요한 스킬과 직업 안내
- **위험 물체 경고**: 저주받은 제단, 독성 구름 등 위험 표시

#### 특수 타일 시스템
- **신성한 제단**: 신성마법 (성기사, 신관)
- **마법 수정**: 정령술 (정령술사, 아크메이지)
- **고대 레버**: 기계조작 (기계공학자, 도적)
- **고대 서적**: 지식탐구 (철학자, 아크메이지)
- **마법 대장간**: 기계공학 (기계공학자)
- **신비한 정원**: 자연친화 (드루이드)

#### 위험 타일 시스템
- **저주받은 제단**: 신성마법으로 정화 가능
- **독성 구름**: 자연친화로 중화 가능
- **어둠의 포털**: 정령술로 차단 가능
- **불안정한 바닥**: 기계조작으로 보강 가능
- **확인 시스템**: 위험한 물체 상호작용 시 재확인

#### 적 AI 시스템 개선
- **추적 시스템**: 플레이어 5타일 내에서 추적
- **랜덤 이동**: 시야 밖에서 25% 확률 랜덤 이동
- **디버그 로그**: 적 이동 상세 정보 출력
- **이동 조건**: _can_move_to() 메서드로 안전한 이동 검증

### 17. � 종합 로깅 시스템 (Comprehensive Logging System) - 2025년 8월 10일 완성
#### 🎯 로그 시스템 개요
Dawn of Stellar 게임은 **완전한 한국어 로깅 시스템**을 갖추고 있습니다. 모든 게임 활동이 실시간으로 기록되며, 문제 발생 시 즉시 원인을 파악할 수 있도록 설계되었습니다.

#### 📁 로그 파일 구조 (세션별 한국어 파일명)
```
게임로그/
├── 세션_20250810_143052/           # 세션별 폴더 (날짜_시간)
│   ├── 오류로그_143052.log         # 🔴 게임 오류 및 예외사항
│   ├── 전투로그_143052.log         # ⚔️ 모든 전투 관련 활동
│   ├── 적로그_143052.log           # 👹 적 생성, 이동, AI 행동
│   ├── 플레이어로그_143052.log     # 🎮 플레이어 입력 및 행동
│   ├── 월드로그_143052.log         # 🗺️ 맵 생성, 월드 이벤트
│   ├── 시스템로그_143052.log       # 🔧 게임 시스템 동작
│   └── 디버그로그_143052.log       # 🐛 개발 및 디버깅 정보
│
├── 루트 레벨 로그 파일들:
├── latest_errors.log               # 🚨 최신 오류 요약 (실시간)
├── game_debug.log                  # 🔍 게임 시작 및 모듈 로딩
└── game_error.log                  # 💀 치명적 오류 및 크래시
```

#### 🔧 로깅 시스템 핵심 기능
##### 실시간 로깅 (game/error_logger.py)
```python
# 주요 로깅 함수들
log_error(category, message, details=None)     # 오류 로깅
log_debug(category, message, details=None)     # 디버그 로깅  
log_combat(category, message, details=None)    # 전투 로깅
log_enemy(category, message, details=None)     # 적 행동 로깅
log_player(category, message, details=None)    # 플레이어 로깅
log_world(category, message, details=None)     # 월드 이벤트 로깅
log_system(category, message, details=None)    # 시스템 로깅

# 종합 로거 획득
logger = get_comprehensive_logger()
```

##### 자동 세션 관리
- **세션 생성**: 게임 시작 시 자동으로 새 세션 폴더 생성
- **파일명 규칙**: `카테고리로그_세션시간.log` (완전 한국어)
- **실시간 기록**: 모든 게임 이벤트가 즉시 해당 카테고리 로그에 기록
- **세션 분리**: 각 게임 실행마다 독립적인 로그 폴더

#### 📊 로그 카테고리별 세부 정보
##### 🔴 오류로그 (오류로그_*.log)
- **Python 예외**: 모든 try-catch 블록의 예외
- **게임 오류**: 로직 오류, 데이터 불일치
- **시스템 오류**: 파일 I/O, 메모리 문제
- **모듈 로딩 실패**: import 오류, 의존성 문제

##### ⚔️ 전투로그 (전투로그_*.log)
- **전투 시작/종료**: 전투 참가자, 결과
- **행동 로그**: 각 캐릭터의 스킬 사용, 피해량
- **ATB 시스템**: 게이지 변화, 턴 순서
- **상태 변화**: HP/MP/BRV 변화, 버프/디버프
- **장비 효과**: 장비 보너스 적용 내역

##### 👹 적로그 (적로그_*.log)
- **적 생성**: 던전별 적 스폰 정보
- **AI 행동**: 적의 이동, 공격 선택 로직
- **추적 시스템**: 플레이어 감지 및 추적 과정
- **이동 실패**: 이동할 수 없는 이유 (벽, 다른 적)

##### 🎮 플레이어로그 (플레이어로그_*.log)
- **입력 기록**: 모든 키 입력 및 명령
- **이동 로그**: 플레이어 위치 변화
- **인벤토리**: 아이템 획득, 사용, 장착
- **스킬 사용**: 플레이어 스킬 및 아이템 사용
- **메뉴 조작**: 게임 내 메뉴 탐색 기록

##### 🗺️ 월드로그 (월드로그_*.log)
- **맵 생성**: 던전 레이아웃 생성 과정
- **맵 장치**: 함정, 보물상자, 특수 타일 상호작용
- **환경 이벤트**: 레벨 변화, 특수 이벤트 발생
- **위치 시스템**: 플레이어 및 적의 위치 추적

##### 🔧 시스템로그 (시스템로그_*.log)
- **게임 초기화**: 시스템 컴포넌트 로딩
- **저장/로드**: 세이브 파일 처리 과정
- **설정 변경**: 게임 설정 수정 내역
- **메모리 관리**: 리소스 사용량 모니터링

##### 🐛 디버그로그 (디버그로그_*.log)
- **개발 정보**: 개발 과정에서 필요한 상세 정보
- **성능 측정**: 함수 실행 시간, 메모리 사용량
- **변수 상태**: 중요 변수들의 값 변화 추적
- **실험적 기능**: 새로운 기능 테스트 로그

#### 🚨 문제 해결 가이드
##### 즉시 확인해야 할 로그 파일들
1. **latest_errors.log**: 가장 최근 오류들의 요약
2. **오류로그_*.log**: 해당 세션의 모든 오류 상세 정보
3. **game_debug.log**: 게임 시작 과정에서 발생한 문제
4. **game_error.log**: 치명적 오류로 인한 게임 크래시

##### 특정 문제별 로그 파일 가이드
- **플레이어가 움직이지 않을 때**: 플레이어로그 + 시스템로그
  - 확인할 키워드: "플레이어이동", "위치변경", "이동실패", "키입력"
  - 증상: 키를 눌러도 플레이어가 움직이지 않음
  - 원인 파악: 입력 처리 오류, 이동 로직 버그, 충돌 감지 문제
  
- **적이 움직이지 않을 때**: 적로그 + 월드로그
  - 확인할 키워드: "적이동", "AI행동", "추적", "move_enemies"
  - 증상: 적들이 제자리에서 움직이지 않음
  - 원인 파악: AI 로직 버그, 이동 조건 실패, 추적 시스템 오류
  
- **전투가 시작되지 않을 때**: 전투로그 + 적로그 + 플레이어로그
  - 확인할 키워드: "전투시작", "전투감지", "충돌감지", "전투진입"
  - 증상: 적과 만나도 전투가 발생하지 않음
  - 원인 파악: 충돌 감지 실패, 전투 시작 조건 미충족
  
- **이동 판정 문제**: 플레이어로그 + 월드로그 + 시스템로그
  - 확인할 키워드: "이동판정", "위치업데이트", "좌표변경", "맵상태"
  - 증상: 이동했지만 게임이 인식하지 못함
  - 원인 파악: 좌표 업데이트 실패, 맵 상태 동기화 오류
  
- **아이템/장비 문제**: 플레이어로그 + 시스템로그
- **게임 크래시**: game_error.log + 오류로그
- **성능 문제**: 디버그로그 + 시스템로그

##### 긴급 진단 체크리스트 (이동/전투 문제)
1. **즉시 확인**: `latest_errors.log` - 최근 오류 있는지 확인
2. **플레이어 상태**: `플레이어로그_*.log` - 마지막 이동 기록 확인
3. **적 상태**: `적로그_*.log` - 적 생성 및 이동 기록 확인
4. **월드 상태**: `월드로그_*.log` - 맵 생성 및 업데이트 확인
5. **시스템 상태**: `시스템로그_*.log` - 초기화 및 설정 문제 확인

##### 로그 분석 팁
```python
# 로그 파일에서 특정 문제 찾기 예시
# 1. 플레이어 이동 문제
grep "플레이어이동\|이동실패\|위치변경\|키입력" 플레이어로그_*.log

# 2. 적 AI 문제  
grep "적이동\|추적\|AI행동\|move_enemies" 적로그_*.log

# 3. 전투 관련 문제
grep "전투시작\|ATB\|데미지\|전투감지" 전투로그_*.log

# 4. 최근 오류 확인
tail -50 latest_errors.log

# 5. 이동 판정 문제 (플레이어가 움직였는데 인식 안됨)
grep "이동판정\|위치업데이트\|좌표변경" 플레이어로그_*.log
grep "맵상태\|위치동기화" 월드로그_*.log

# 6. 게임 시작 문제
grep "초기화\|모듈로딩\|설정" 시스템로그_*.log

# 7. 특정 세션의 모든 로그 확인
ls -la 게임로그/세션_YYYYMMDD_HHMMSS/

# 8. 실시간 로그 모니터링 (새 터미널에서)
tail -f 게임로그/세션_*/플레이어로그_*.log
```

##### 윈도우 PowerShell 명령어
```powershell
# 1. 최근 오류 확인
Get-Content latest_errors.log -Tail 20

# 2. 플레이어 이동 로그 검색
Select-String "플레이어이동|이동실패|위치변경" 게임로그\*\플레이어로그_*.log

# 3. 적 AI 로그 검색  
Select-String "적이동|추적|AI행동" 게임로그\*\적로그_*.log

# 4. 전투 로그 검색
Select-String "전투시작|전투감지|충돌감지" 게임로그\*\전투로그_*.log

# 5. 세션 폴더 목록
Get-ChildItem 게임로그 -Directory | Sort-Object Name -Descending

# 6. 최신 세션의 모든 로그 파일
Get-ChildItem (Get-ChildItem 게임로그 -Directory | Sort-Object Name -Descending | Select-Object -First 1).FullName
```

#### 🎯 로깅 시스템 사용법 (개발자용)
##### 새로운 로그 추가하기
```python
from game.error_logger import log_debug, log_error, log_player

# 플레이어 이동 로깅
log_player("플레이어이동", f"위치 변경: {old_pos} → {new_pos}", {
    "이전위치": old_pos,
    "새위치": new_pos,
    "이동성공": True
})

# 오류 로깅
log_error("장비시스템", "장비 장착 실패", {
    "아이템": item.name,
    "캐릭터": character.name,
    "실패원인": "슬롯이 이미 사용 중"
})

# 디버그 로깅
log_debug("ATB시스템", "ATB 게이지 업데이트", {
    "캐릭터": character.name,
    "이전ATB": old_atb,
    "현재ATB": new_atb,
    "증가량": increase_amount
})
```

##### 로그 조회 함수들
```python
from game.error_logger import get_recent_errors, get_session_logs

# 최근 오류 5개 가져오기
recent_errors = get_recent_errors(5)

# 현재 세션의 로그 파일 경로들 가져오기
log_paths = get_session_logs()
```

#### ⚡ 성능 최적화
- **비동기 로깅**: 게임 성능에 영향 없는 백그라운드 로깅
- **로그 레벨**: 개발/디버그/릴리즈 모드별 로그 필터링
- **파일 크기 관리**: 자동 로그 로테이션 및 압축
- **빠른 검색**: 카테고리별 인덱싱으로 빠른 로그 검색

#### 📱 모바일 클라이언트 로깅
- **HTTP 로그 전송**: 모바일에서 백엔드로 로그 전송
- **실시간 동기화**: 게임 진행 상황 실시간 로깅
- **오프라인 로깅**: 네트워크 끊김 시 로컬 로그 저장

#### 🚨 긴급 문제 해결 프로세스
##### 이동 시스템 문제 (플레이어가 움직이지 않는 경우)
1. **즉시 확인**: `latest_errors.log` 파일 열어서 최근 오류 확인
2. **플레이어 로그 확인**: `게임로그/세션_*/플레이어로그_*.log`에서 마지막 이동 기록 찾기
3. **시스템 로그 확인**: `게임로그/세션_*/시스템로그_*.log`에서 초기화 문제 확인
4. **키워드 검색**: "플레이어이동", "위치변경", "키입력", "이동실패" 키워드로 검색

##### 적 AI 문제 (적이 움직이지 않는 경우)
1. **적 로그 확인**: `게임로그/세션_*/적로그_*.log`에서 적 생성 및 이동 기록 확인
2. **AI 행동 확인**: "적이동", "AI행동", "추적", "move_enemies" 키워드 검색
3. **월드 로그 확인**: `게임로그/세션_*/월드로그_*.log`에서 맵 상태 확인
4. **디버그 정보**: "적AI디버그", "이동조건", "추적범위" 키워드 검색

##### 전투 시스템 문제 (전투가 발생하지 않는 경우)
1. **전투 로그 확인**: `게임로그/세션_*/전투로그_*.log`에서 전투 감지 기록 확인
2. **충돌 감지 확인**: "전투감지", "충돌감지", "전투진입" 키워드 검색
3. **플레이어-적 상호작용**: 플레이어로그와 적로그를 동시에 확인

##### 실시간 디버깅 방법
```bash
# 게임 실행 중 실시간 로그 모니터링 (새 터미널에서)
# PowerShell
Get-Content "게임로그\세션_최신\플레이어로그_*.log" -Wait -Tail 10

# 또는
tail -f "게임로그/세션_*/플레이어로그_*.log"
```

**💡 핵심**: 문제가 발생하면 항상 로그부터 확인하세요! 게임의 모든 동작이 실시간으로 기록되므로 원인을 빠르게 파악할 수 있습니다.

### 18. �🔧 최근 수정사항 (2025년 8월 10일)
#### 주요 수정 내역
1. **ATB 시스템 속도 조정**
   - base_increase 25 → 15로 감소하여 게임 속도 적절히 조절
   - 플레이어가 "너무 빨리참"이라고 한 피드백 반영
   - 캐스팅 시간과 전투 템포 밸런스 개선

2. **AI 모드 검증 시스템 강화**
   - 일반 게임모드에서 AI가 활성화되는 문제 완전 해결
   - is_ai_game_mode_enabled() 메서드 보수적 접근법 적용
   - BraveCombatSystem 생성 시 set_ai_game_mode(False) 자동 호출
   - 메인 모듈 체크 비활성화로 false positive 방지

3. **화면 깜빡임 문제 해결**
   - 전투 중 검정화면 되는 문제 해결
   - clear_screen=False 적용 확대
   - 안정적인 출력 시스템으로 화면 전환 부드럽게

4. **맵 장치 상호작용 완전 구현**
   - Enter키로 주변 객체 상호작용 메뉴 시스템
   - 밟아서 작동하는 타일 자동 처리 (치유의 샘, 함정)
   - 스킬 부족시에도 안내 메시지와 함께 표시
   - 위험한 물체에 대한 경고 및 확인 시스템

5. **적 이동 시스템 디버깅**
   - 적이 움직이지 않는 문제 진단을 위한 디버그 로그 추가
   - move_enemies() 메서드 상세 정보 출력
   - 플레이어 추적 및 랜덤 이동 로직 시각화

6. **커서 메뉴 시스템 안정화**
   - 'list' object has no attribute 'replace' 오류 해결
   - extra_content 타입 체크 및 안전한 변환 추가
   - 메뉴 시스템 전반적 안정성 개선

#### 해결된 버그들 (2025.08.10)
- ✅ ATB 게이지 너무 빨리 차는 문제 (속도 조정)
- ✅ 일반 게임모드에서 AI가 제어하는 문제 (AI 모드 검증 강화)
- ✅ 전투 중 화면이 검정색이 되는 문제 (clear_screen 최적화)
- ✅ 맵 장치들이 작동하지 않는 문제 (상호작용 시스템 완성)
- ✅ 커서 메뉴에서 리스트 타입 오류 (타입 안전성 개선)
- ⚠️ 적 이동 문제 (디버그 로그 추가, 진단 중)

#### 현재 상태 (2025.08.10)
- **ATB 시스템**: 적절한 속도로 밸런스 조정 완료
- **AI 모드 검증**: 강화된 안전 체크로 false positive 방지
- **화면 시스템**: 깜빡임 방지로 부드러운 UI 경험
- **맵 상호작용**: 완전한 상호작용 시스템 구현
- **적 AI**: 디버그 정보 추가하여 문제 진단 중

#### 오류 로그 모니터링 (2025.08.10)
**주요 로그 파일들**:
- `latest_errors.log`: 실시간 오류 추적 및 디버그 정보
- `game_debug.log`: 게임 시작 및 모듈 로딩 로그
- `game_error.log`: 치명적 오류 및 크래시 정보

**로그에서 발견된 패턴**:
- AI 모드 디버그: "클래식 게임모드 상태: False" 정상 확인
- 커서 메뉴 오류: extra_content 타입 문제 해결됨
- atonement_stack 매개변수: 이미 수정 완료
- Character 속성 오류: member.hp → member.current_hp 사용 확인

## 🛠️ Technical Architecture

### Core Modules
```python
main.py                 # 게임 메인 엔트리 포인트
config.py              # 게임 설정 관리
game/
├── brave_combat.py    # 전투 시스템 핵심
├── character.py       # 캐릭터 클래스
├── party_manager.py   # 파티 관리
├── world.py           # 월드/던전 생성/관리
├── skill_system.py    # 스킬 데이터베이스
├── item_system.py     # 아이템 관리
├── ai_game_mode.py    # AI 시스템
├── trait_system.py    # 특성 시스템
├── audio_system.py    # 오디오 관리
└── save_system.py     # 저장/로드
```

### 🎨 UI/UX Systems
#### Display Systems
- **BufferedDisplay**: 화면 깜빡임 방지
- **ColorSystem**: 256색 컬러 시스템
- **CursorMenu**: 커서 기반 메뉴
- **GameDisplay**: 게임 화면 렌더링

#### Input Systems
- **KeyboardInput**: 키보드 입력 처리
- **MenuNavigation**: 메뉴 탐색 시스템
- **HotkeySystem**: 단축키 시스템

### 🔧 Utility Systems
- **GameStateEncoder**: JSON 직렬화
- **ErrorHandler**: 예외 처리
- **PerformanceMonitor**: 성능 모니터링
- **DebugSystem**: 디버그 기능

## 📊 Game Balance & Mechanics

### Damage Formula
```python
기본_피해 = (공격력 / 방어력) * 스킬_배율
최종_피해 = 기본_피해 * 특성_배율 * 상태_배율
BRV_피해 = 최종_피해 * BRV_배율
HP_피해 = BRV_포인트 * HP_배율
```

### Status Effects
- **독**: 턴마다 HP 감소
- **화상**: 행동 시 추가 피해
- **빙결**: 행동 불가
- **마비**: 확률적 행동 실패
- **축복**: 모든 능력치 증가
- **저주**: 모든 능력치 감소

### Critical System
- **크리티컬 확률**: 기본 5% + 운 스탯
- **크리티컬 배율**: 1.5배 ~ 2.0배
- **크리티컬 효과**: 추가 상태이상 부여

## 🎮 Code Style Guidelines

### Naming Conventions
- **변수명**: snake_case (한글 주석 포함)
- **클래스명**: PascalCase
- **함수명**: snake_case
- **상수명**: UPPER_SNAKE_CASE

### Design Patterns
- **Singleton**: 게임 매니저 클래스들
- **Factory**: 캐릭터/아이템 생성
- **Observer**: 이벤트 시스템
- **Strategy**: AI 행동 패턴
- **Command**: 액션 시스템

### Error Handling
```python
try:
    # 게임 로직
    result = perform_action()
except GameException as e:
    # 게임 내 예외 처리
    handle_game_error(e)
except Exception as e:
    # 시스템 예외 처리
    log_error(e)
    show_error_dialog()
```

## 🚀 Performance Optimization

### Memory Management
- **객체 풀링**: 자주 생성되는 객체 재사용
- **지연 로딩**: 필요할 때만 리소스 로드
- **가비지 컬렉션**: 수동 메모리 정리

### Display Optimization
- **더블 버퍼링**: 화면 깜빡임 방지
- **부분 업데이트**: 변경된 부분만 다시 그리기
- **프레임 제한**: 60 FPS 제한

## 🐛 Debugging & Testing

### Debug Features
- **치트 모드**: 개발자 전용 치트
- **로그 시스템**: 상세 게임 로그
- **상태 확인**: 실시간 게임 상태 모니터링

### Testing Strategy
- **단위 테스트**: 개별 함수 테스트
- **통합 테스트**: 시스템 간 연동 테스트
- **플레이 테스트**: 실제 게임플레이 테스트

## 🔮 Future Expansion Plans

### Planned Features
- **멀티플레이어**: 온라인 협동/대전
- **모드 시스템**: 사용자 제작 콘텐츠
- **시즌 시스템**: 정기 업데이트 콘텐츠
- **토너먼트**: 경쟁 모드

### Technical Improvements
- **3D 그래픽**: 3D 모델 지원
- **음성 지원**: 캐릭터 음성
- **클라우드 저장**: 온라인 저장 시스템

## 🎯 Game Development Philosophy

### Core Principles
1. **플레이어 경험 우선**: 재미와 몰입감
2. **접근성**: 누구나 쉽게 시작
3. **깊이**: 마스터하기 어려운 깊이
4. **공정성**: 운보다는 실력 중심
5. **창의성**: 다양한 플레이 스타일 지원

### Quality Standards
- **버그 없는 게임**: 철저한 테스트
- **직관적 UI**: 쉬운 조작법
- **빠른 로딩**: 대기시간 최소화
- **안정적 성능**: 모든 환경에서 안정적

## 📝 Important Game Mechanics Notes

### Combat System
- BRV 공격은 적의 BRV를 감소시키고 자신의 BRV 증가
- HP 공격은 자신의 BRV를 소모하여 적의 HP 감소
- BREAK 상태의 적은 다음 턴까지 행동 불가
- 상처 시스템으로 단순 회복만으로는 완전 회복 불가

### Character Progression
- 레벨업 시 스탯 자동 증가
- 직업별 고유 스킬 트리
- 특성 시스템으로 개성화
- 장비를 통한 추가 스탯 보정

### Resource Management
- HP: 생명력 (0이 되면 전투불능)
- MP: 마법력 (스킬 사용에 소모)
- BRV: 용기 (HP 공격의 위력 결정)
- 스태미나: 던전 탐험 시 소모

### Strategic Depth
- 직업 조합에 따른 시너지 효과
- 적의 약점/저항 시스템
- 전장 위치에 따른 전략 변화
- 시간 관리 (ATB 게이지 활용)

### World Interaction
- Enter키로 주변 객체 조사 및 상호작용
- 밟아서 작동하는 특수 타일 (치유의 샘, 함정)
- 스킬 기반 상호작용 시스템 (자물쇠해제, 신성마법 등)
- 위험한 물체에 대한 경고 및 확인 시스템

이 게임은 단순한 로그라이크를 넘어서 현대적 JRPG의 모든 요소를 담은 종합 RPG 시스템입니다!

#### Brave Point 시스템 (FF 스타일)
- **BRV 축적**: Brave 공격으로 포인트 획득
- **HP 공격**: BRV 소모하여 실제 피해
- **BREAK 시스템**: BRV 0일 때 무력화 상태
- **INT BRV**: 턴 시작 시 기본 BRV 회복
- **BRV 보정**: 직업별/장비별 BRV 보너스

#### 상처 시스템 (Wound System)
- **상처 축적**: 받은 피해의 25%가 상처로 누적
- **최대 상처**: 최대 HP의 75%까지 제한
- **상처 치유**: 초과 회복의 25%로 상처 치료
- **영구 피해**: 상처는 전투 종료 후에도 지속

#### 통합 데미지 시스템 (Unified Damage System)
- **물리/마법 피해**: 방어력 계산 통합
- **크리티컬 시스템**: 직업별 크리티컬 보정
- **상성 시스템**: 직업간 상성 보너스/페널티
- **저항/약점**: 원소별 저항/약점 시스템

### 3. 👥 파티 관리 시스템 (Party Management)
- **파티 크기**: 최대 4명 구성
- **직업 시스템**: 28개 고유 직업 (2025년 업데이트)
- **동료 시스템**: NPC 동료 영입
- **AI 동료**: 자동 전투 AI 탑재
- **파티 밸런스**: 탱커, 딜러, 힐러, 서포터 역할 분담
- **협력 스킬**: 파티원 간 연계 공격

### 4. 🎓 직업 시스템 (Character Classes) - 28개 직업
#### 전투 직업군 (8개)
- **전사**: 적응형 방패 강타, 파괴의 일격
- **아크메이지**: 마력 파동, 마력 폭발
- **궁수**: 삼연사, 관통사격 + 지원사격 시스템
- **도적**: 독침, 암살 + 맹독 시스템
- **성기사**: 성스러운 타격, 심판의 빛
- **암흑기사**: 흡혈 베기, 흡혈 강타
- **몽크**: 연환 타격, 폭렬권 + 표식 시스템
- **바드**: 음파 공격, 영혼의 노래 + 사기 시스템

#### 마법 직업군 (10개)
- **네크로맨서**: 생명력 흡수, 영혼 흡수
- **용기사**: 화염 강타, 드래곤 브레스
- **검성**: 검기 베기, 일섬
- **정령술사**: 원소 탄환, 원소 융합
- **시간술사**: 시간 조작, 시간 정지
- **연금술사**: 화학 폭발, 대폭발 반응
- **차원술사**: 차원 균열, 차원 붕괴
- **마검사**: 마법검기, 마검 오의
- **기계공학자**: 레이저 사격, 메가 레이저 (수정됨)
- **무당**: 영혼 타격, 영혼 분리 (밸런스 수정)

#### 특수 직업군 (10개)
- **암살자**: 그림자 강타, 그림자 처형 + 그림자 시스템
- **해적**: 이도류 난타, 해적의 보물
- **사무라이**: 거합 베기, 무사도 비의
- **드루이드**: 자연의 분노, 자연의 심판
- **철학자**: 논리적 반박, 진리의 깨달음
- **검투사**: 투기장 기술, 검투장의 피날레
- **기사**: 창 돌격, 성스러운 돌격
- **신관**: 축복의 빛, 신의 심판
- **광전사**: 광폭화 난타, 최후의 광기

### 5. ✨ 스킬 시스템 (New Skill System) - 2025년 완전 개편
#### 스킬 타입
- **BRV_ATTACK**: Brave 포인트 획득 공격 (기본 공격)
- **HP_ATTACK**: 직접 HP 피해 공격 (기본 공격)
- **BRV_HP_ATTACK**: BRV 획득 + HP 피해 복합
- **ULTIMATE**: 궁극기 (높은 MP 소모)
- **SUPPORT**: 지원/회복 스킬
- **DEBUFF**: 적 약화 스킬

#### 스킬 데이터베이스 구조
```python
# 각 직업별 기본 공격 2개 (MP 0)
{"name": "기계타격", "mp_cost": 0, "type": SkillType.BRV_ATTACK}
{"name": "에너지방출", "mp_cost": 0, "type": SkillType.HP_ATTACK}

# 전술 스킬들 (MP 소모)
{"name": "자기장_조작", "mp_cost": 12, "type": SkillType.SUPPORT}
```

#### 캐스팅 시스템
- **캐스트 타임**: 스킬별 시전 시간 (0.5초~3초)
- **중단 가능**: 피해 받으면 캐스팅 중단
- **ATB 연동**: 캐스팅 중 ATB 게이지 표시
- **즉시 시전**: MP 0 기본 공격은 즉시 실행

#### 특수 스킬 시스템
- **기계공학자**: 장비 조작 스킬 (적용 범위 수정)
- **바드**: 음표 중첩 방지 시스템
- **무당**: 영혼 스킬 밸런스 조정
- **도적**: 맹독 시스템 + 독 촉진
- **궁수**: 조준 포인트 + 지원사격
- **암살자**: 그림자 시스템 연동

### 6. 🎒 인벤토리 & 아이템 시스템
#### 아이템 카테고리
- **소모품**: 회복 포션, 버프 아이템
- **장비**: 무기, 방어구, 액세서리
- **재료**: 제작 재료, 강화 석
- **귀중품**: 퀘스트 아이템, 수집품

#### 장비 시스템 (Equipment System) - 2025.08.08 수정
- **확장 장비 클래스**: Equipment 클래스 기반
- **내구도 시스템**: 사용에 따른 내구도 감소
- **특수 효과**: EquipmentEffect 클래스
- **세트 장비**: 세트 효과 시스템
- **원소 저항**: ElementType 기반 저항/약점
- **인벤토리 연동**: 장착/해제 시 인벤토리 자동 관리
- **중복 방지**: equip_item 메서드 단일화로 아이템 소실 방지

#### 제작 시스템 (Crafting)
- **요리 시스템**: 음식 제작으로 버프 효과
- **연금술**: 포션 및 특수 아이템 제작
- **강화 시스템**: 장비 강화 및 인챈트

### 7. 🧬 특성 시스템 (Trait System)
#### 특성 타입
- **패시브 특성**: 항상 활성화된 효과
- **액티브 특성**: 수동 발동 특성
- **전투 특성**: 전투 중 자동 발동
- **조건부 특성**: 특정 조건에서 발동

#### 특성 예시
- **동물 변신**: 늑대/곰/독수리 형태 변환
- **원소 친화**: 원소 마법 위력 증가
- **전투 광**: 체력 낮을수록 공격력 증가
- **치유술사**: 회복 효과 2배 증가

### 8. 🤖 AI 시스템 (AI Game Mode)
#### AI 동료 시스템
- **자동 전투**: AI가 최적 행동 선택
- **전략적 판단**: 상황 분석 후 행동 결정
- **협력 플레이**: 플레이어와 협력 전술
- **학습 능력**: 플레이 패턴 학습 및 적응

#### AI 행동 패턴
- **공격**: 최적 타겟 선택 (직업별 전략)
- **스킬**: 상황별 스킬 사용 (MP 0 기본 공격 포함)
- **방어**: 위험 상황 시 방어
- **치료**: 아군 체력 관리
- **아이템**: 필요 시 아이템 사용
- **요청**: 플레이어에게 지시 요청

#### 전술적 AI 우선순위
- **emergency_heal**: 응급 치료 (HP 20% 이하)
- **support_heal**: 지원 치료 (파티 HP 60% 이하)
- **ultimate_attack**: 궁극기 사용 (MP 20 이상)
- **tactical_skill**: 전술 스킬 (MP 12 이상)
- **hp_attack**: HP 공격 (BRV 400 이상)
- **brv_attack**: BRV 공격 (기본 행동)

### 9. 🎵 오디오 시스템 (Audio System)
#### BGM 시스템
- **상황별 BGM**: 던전, 전투, 마을, 보스
- **동적 전환**: 상황에 따른 자연스러운 전환
- **루프 재생**: 끊김 없는 배경음악
- **BGMType enum**: DUNGEON, BATTLE, BOSS, VICTORY 등

#### SFX 시스템
- **전투음**: 공격, 스킬, 방어음
- **환경음**: 발걸음, 문 여는 소리
- **UI음**: 메뉴, 선택, 확인음
- **스킬별 SFX**: 각 스킬마다 고유 효과음

### 10. 💾 저장 시스템 (Save System)
#### 저장 데이터
- **캐릭터 진행도**: 레벨, 경험치, 스탯
- **인벤토리**: 아이템, 장비, 돈
- **던전 진행**: 탐험한 층수, 맵 정보
- **퀘스트**: 진행 중/완료된 퀘스트
- **설정**: 게임 설정, 키 바인딩

#### 자동 저장
- **던전 진입**: 새 층 진입 시 자동 저장
- **전투 승리**: 중요 전투 후 자동 저장
- **상점 이용**: 거래 완료 후 자동 저장

### 11. 🎯 난이도 시스템 (Difficulty System)
- **쉬움**: 초보자용 (피해 -30%, 경험치 +20%)
- **보통**: 표준 난이도
- **어려움**: 도전적 (피해 +50%, 경험치 +50%)
- **지옥**: 극한 도전 (피해 +100%, 특수 보상)

### 12. 🏆 업적 시스템 (Achievement System)
- **전투 업적**: 연속 승리, 완벽한 승리
- **탐험 업적**: 층수 도달, 비밀 발견
- **수집 업적**: 아이템 수집, 도감 완성
- **특수 업적**: 숨겨진 조건 달성

### 13. 🎮 UI/UX 시스템 (Interface Systems)
#### 애니메이션 시스템
- **게이지 애니메이션**: HP/MP/BRV/ATB 실시간 애니메이션
- **SequentialGaugeAnimator**: 순차적 게이지 처리
- **BufferedDisplay**: 화면 깜빡임 방지
- **부드러운 전환**: easeInOutQuad 곡선 적용

#### 입력 시스템
- **CursorMenu**: 커서 기반 메뉴 시스템
- **KeyboardInput**: 키보드 입력 처리
- **HotkeySystem**: 단축키 시스템
- **InputBuffer**: 입력 버퍼 관리

#### 표시 시스템
- **ColorSystem**: 256색 컬러 시스템
- **GameDisplay**: 게임 화면 렌더링
- **StatusDisplay**: 실시간 상태 표시
- **CombatVisualizer**: 전투 시각 효과

### 14. 🛡️ 장비 관리 시스템 (Equipment Management)
#### AI 자동 장착 시스템
- **BasicEquipmentManager**: 자동 장비 최적화
- **안전한 장착**: 아이템 소실 방지 시스템
- **인벤토리 연동**: 장착/해제 시 인벤토리 동기화
- **보너스 적용**: 장비 효과 자동 계산

#### 장비 효과 시스템
- **스탯 보너스**: 기본 능력치 증가
- **특수 효과**: SpecialEffect enum 기반
- **세트 효과**: 같은 세트 장비 착용 시 추가 효과
- **내구도 관리**: 사용에 따른 내구도 감소 및 수리

### 15. 🌑 특수 메커니즘 시스템
#### 그림자 시스템 (암살자 전용)
- **그림자 생성**: 공격 시 그림자 소환
- **그림자 메아리**: 추가 피해 효과
- **그림자 처형**: 모든 그림자 소모 강력한 일격

#### 맹독 시스템 (도적 전용)
- **독 중첩**: 최대 96스택까지 독 누적
- **독 촉진**: HP 공격 시 독 피해 즉시 적용
- **독 면역**: 특정 조건에서 독 면역 획득

#### 조준 시스템 (궁수 전용)
- **조준 포인트**: 공격마다 조준 정확도 증가
- **지원사격**: 턴 종료 시 추가 공격
- **관통 공격**: 여러 적에게 동시 피해

### 16. 🔧 최근 수정사항 (2025년 8월 8일)
#### 주요 수정 내역
1. **ATB 시스템 완전 수정**
   - player_turn에서 캐스팅 중이거나 행동하지 않은 경우 ATB 차감 방지
   - battle_loop에서 실제 행동한 경우에만 action_cost=1000 차감
   - get_action_order()로 공정한 우선순위 기반 턴 선택
   - 아군 턴 누락 문제 해결 완료

2. **장비 시스템 안정화**
   - 중복된 equip_item 메서드 제거
   - 인벤토리 연동 equip_item만 사용하여 아이템 소실 방지
   - 장착/해제 시 인벤토리 자동 동기화
   - 저장/로드 시 장비와 인벤토리 일치성 보장

3. **Flutter 모바일 클라이언트 완성**
   - 제스처 기반 이동 (스와이프)
   - DraggableScrollableSheet 컨트롤 패널
   - 입력 디바운싱 및 자동 연타 방지
   - 터미널 스타일 UI + "@" 로고
   - 확인(Enter), 취소(Q), ESC(FAB) 매핑

4. **AI 시스템 최적화**
   - AI 모드 기본 비활성화로 아군 직접 제어
   - 전술적 우선순위 시스템 완성
   - MP 0 기본 공격 포함 AI 로직
   - 캐릭터별 특성 기반 AI 전술

#### 해결된 버그들
- ✅ 아군 ATB 가득 차도 턴이 안 오는 문제
- ✅ 장비 로드 시 인벤토리에서 사라지는 문제
- ✅ Flutter 무한 높이 DraggableScrollableSheet 에러
- ✅ 버튼 자동 연타 문제
- ✅ AI가 기본 공격을 사용하지 않는 문제

#### 현재 상태 (2025.08.08)
- **ATB 시스템**: 완전 작동, 공정한 턴 분배
- **장비 시스템**: 안정적 인벤토리 연동
- **모바일 클라이언트**: 완성된 UI/UX
- **AI 시스템**: 최적화된 전투 AI
- **저장 시스템**: 무결성 보장

## 🛠️ Technical Architecture

### Core Modules
```python
main.py                 # 게임 메인 엔트리 포인트
config.py              # 게임 설정 관리
game/
├── brave_combat.py    # 전투 시스템 핵심
├── character.py       # 캐릭터 클래스
├── party_manager.py   # 파티 관리
├── world.py           # 월드/던전 생성/관리
├── skill_system.py    # 스킬 데이터베이스
├── item_system.py     # 아이템 관리
├── ai_game_mode.py    # AI 시스템
├── trait_system.py    # 특성 시스템
├── audio_system.py    # 오디오 관리
└── save_system.py     # 저장/로드
```

### 🎨 UI/UX Systems
#### Display Systems
- **BufferedDisplay**: 화면 깜빡임 방지
- **ColorSystem**: 256색 컬러 시스템
- **CursorMenu**: 커서 기반 메뉴
- **GameDisplay**: 게임 화면 렌더링

#### Input Systems
- **KeyboardInput**: 키보드 입력 처리
- **MenuNavigation**: 메뉴 탐색 시스템
- **HotkeySystem**: 단축키 시스템

### 🔧 Utility Systems
- **GameStateEncoder**: JSON 직렬화
- **ErrorHandler**: 예외 처리
- **PerformanceMonitor**: 성능 모니터링
- **DebugSystem**: 디버그 기능

## 📊 Game Balance & Mechanics

### Damage Formula
```python
기본_피해 = (공격력 / 방어력) * 스킬_배율
최종_피해 = 기본_피해 * 특성_배율 * 상태_배율
BRV_피해 = 최종_피해 * BRV_배율
HP_피해 = BRV_포인트 * HP_배율
```

### Status Effects
- **독**: 턴마다 HP 감소
- **화상**: 행동 시 추가 피해
- **빙결**: 행동 불가
- **마비**: 확률적 행동 실패
- **축복**: 모든 능력치 증가
- **저주**: 모든 능력치 감소

### Critical System
- **크리티컬 확률**: 기본 5% + 운 스탯
- **크리티컬 배율**: 1.5배 ~ 2.0배
- **크리티컬 효과**: 추가 상태이상 부여

## 🎮 Code Style Guidelines

### Naming Conventions
- **변수명**: snake_case (한글 주석 포함)
- **클래스명**: PascalCase
- **함수명**: snake_case
- **상수명**: UPPER_SNAKE_CASE

### Design Patterns
- **Singleton**: 게임 매니저 클래스들
- **Factory**: 캐릭터/아이템 생성
- **Observer**: 이벤트 시스템
- **Strategy**: AI 행동 패턴
- **Command**: 액션 시스템

### Error Handling
```python
try:
    # 게임 로직
    result = perform_action()
except GameException as e:
    # 게임 내 예외 처리
    handle_game_error(e)
except Exception as e:
    # 시스템 예외 처리
    log_error(e)
    show_error_dialog()
```

## 🚀 Performance Optimization

### Memory Management
- **객체 풀링**: 자주 생성되는 객체 재사용
- **지연 로딩**: 필요할 때만 리소스 로드
- **가비지 컬렉션**: 수동 메모리 정리

### Display Optimization
- **더블 버퍼링**: 화면 깜빡임 방지
- **부분 업데이트**: 변경된 부분만 다시 그리기
- **프레임 제한**: 60 FPS 제한

## 🐛 Debugging & Testing

### Debug Features
- **치트 모드**: 개발자 전용 치트
- **로그 시스템**: 상세 게임 로그
- **상태 확인**: 실시간 게임 상태 모니터링

### Testing Strategy
- **단위 테스트**: 개별 함수 테스트
- **통합 테스트**: 시스템 간 연동 테스트
- **플레이 테스트**: 실제 게임플레이 테스트

## 🔮 Future Expansion Plans

### Planned Features
- **멀티플레이어**: 온라인 협동/대전
- **모드 시스템**: 사용자 제작 콘텐츠
- **시즌 시스템**: 정기 업데이트 콘텐츠
- **토너먼트**: 경쟁 모드

### Technical Improvements
- **3D 그래픽**: 3D 모델 지원
- **음성 지원**: 캐릭터 음성
- **클라우드 저장**: 온라인 저장 시스템

## 🎯 Game Development Philosophy

### Core Principles
1. **플레이어 경험 우선**: 재미와 몰입감
2. **접근성**: 누구나 쉽게 시작
3. **깊이**: 마스터하기 어려운 깊이
4. **공정성**: 운보다는 실력 중심
5. **창의성**: 다양한 플레이 스타일 지원

### Quality Standards
- **버그 없는 게임**: 철저한 테스트
- **직관적 UI**: 쉬운 조작법
- **빠른 로딩**: 대기시간 최소화
- **안정적 성능**: 모든 환경에서 안정적

## 📝 Important Game Mechanics Notes

### Combat System
- BRV 공격은 적의 BRV를 감소시키고 자신의 BRV 증가
- HP 공격은 자신의 BRV를 소모하여 적의 HP 감소
- BREAK 상태의 적은 다음 턴까지 행동 불가
- 상처 시스템으로 단순 회복만으로는 완전 회복 불가

### Character Progression
- 레벨업 시 스탯 자동 증가
- 직업별 고유 스킬 트리
- 특성 시스템으로 개성화
- 장비를 통한 추가 스탯 보정

### Resource Management
- HP: 생명력 (0이 되면 전투불능)
- MP: 마나 (스킬 사용에 소모)
- BRV: 용기 (HP 공격의 위력 결정)

### Strategic Depth
- 직업 조합에 따른 시너지 효과
- 적의 약점/저항 시스템
- 전장 위치에 따른 전략 변화
- 시간 관리 (ATB 게이지 활용)

### World Interaction
- Enter키로 주변 객체 조사 및 상호작용
- 밟아서 작동하는 특수 타일 (치유의 샘, 함정)
- 스킬 기반 상호작용 시스템 (자물쇠해제, 신성마법 등)
- 위험한 물체에 대한 경고 및 확인 시스템

## 🚨 이동 시스템 문제 해결 완료 (2025.08.10 새벽)

### 문제 상황
- **증상**: 플레이어가 이동해도 플레이어로그가 비어있음, 적도 움직이지 않음, 전투도 발생하지 않음
- **로그 증거**: 적 생성은 기록되지만 플레이어 이동 기록이 전혀 없음

### 원인 발견
1. **플레이어 이동 로깅 완전 누락**: `game/world.py`의 `move_player()` 메서드에서 로깅이 전혀 없음
2. **적 이동 로깅 함수명 불일치**: `logger.log_debug` vs `log_enemy` 혼재
3. **연쇄 반응**: 이동이 기록되지 않으면 → 적 AI 추적 실패 → 전투 감지 실패

### 해결 방법
1. **플레이어 이동 로깅 추가**:
   ```python
   log_player("플레이어이동", f"위치 변경: {old_pos} → {self.player_pos}", {
       "이전위치": old_pos,
       "새위치": self.player_pos,
       "이동량": (dx, dy),
       "이동성공": True
   })
   ```

2. **적 이동 로깅 통일**: 모든 `logger.log_debug` → `log_enemy`로 변경

3. **이동 실패 로깅**: `can_move()` 실패 시에도 원인 기록

### 결과
- ✅ **플레이어 이동**: 이제 모든 이동이 플레이어로그에 기록됨
- ✅ **적 이동**: 추적, 랜덤 이동, 이동 실패가 모두 적로그에 기록됨  
- ✅ **전투 감지**: 적과 충돌 시 전투 감지 로그 추가
- ✅ **문제 진단**: 로그만 보면 이동 시스템 상태를 완전히 파악 가능

이제 게임을 플레이하면 `게임로그/세션_*/플레이어로그_*.log`와 `게임로그/세션_*/적로그_*.log`에서 모든 이동 활동을 실시간으로 확인할 수 있습니다!

이 게임은 단순한 로그라이크를 넘어서 현대적 JRPG의 모든 요소를 담은 종합 RPG 시스템입니다!
