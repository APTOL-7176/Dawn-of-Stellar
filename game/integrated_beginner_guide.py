"""
통합 초보자 가이드 시스템
Dawn Of Stellar 입문자를 위한 친화적인 안내 + 기존 튜토리얼 통합
"""

from typing import Dict, List, Optional
from game.cursor_menu_system import CursorMenu
from game.ascii_effects import play_ascii_sound
import time
import sys


def typewriter_effect(text: str, delay: float = 0.03, pause_on_punctuation: bool = True):
    """타이핑 효과로 텍스트를 한 글자씩 출력"""
    for char in text:
        print(char, end='', flush=True)

        
        # 문장 부호에서 잠시 멈춤
        if pause_on_punctuation and char in '.!?:':
            time.sleep(0.3)
        elif char in ',;':
            time.sleep(0.1)
    print()  # 줄바꿈


def wait_for_user_input(message: str = "📖 계속 읽으려면 Enter를 누르세요..."):
    """사용자 입력을 기다림"""
    print(f"\n{message}")
    try:
        input()
    except KeyboardInterrupt:
        print("\n⚠️ 가이드를 중단합니다.")
        return False
    return True


class IntegratedBeginnerGuide:
    """통합된 초보자 가이드 시스템"""
    
    def __init__(self):
        self.guide_sections = self._create_guide_sections()
        self.current_progress = 0
        
    def _create_guide_sections(self) -> Dict[str, Dict]:
        """초보자 가이드 섹션 생성 - 2025년 8월 완전 개편 반영"""
        return {
            "게임_소개": {
                "title": "🌟 Dawn Of Stellar - 별빛의 여명에 오신 것을 환영합니다!",
                "description": "차세대 판타지 전술 로그라이크 RPG의 세계로!",
                "content": [
                    "👋 환영합니다! 별빛이 비추는 신비한 세계 Dawn Of Stellar에 오신 것을 환영합니다!",
                    "",
                    "🎮 게임이 처음이시라면:",
                    "  • 천천히 따라오시면 됩니다 - 복잡해 보이지만 차근차근!",
                    "  • 실수는 성장의 밑거름! 죽어도 메타 진행으로 더 강해집니다",
                    "  • 언제든지 도움말(H키)을 확인하세요",
                    "  • 궁금한 건 언제든 물어보세요!",
                    "",
                    "🎯 게임의 핵심 목표:",
                    "  1. 28개 직업 중 4명으로 최강 파티를 구성하세요",
                    "  2. 무한 던전을 탐험하며 적을 물리치고 성장하세요",
                    "  3. 별조각을 모아 새로운 캐릭터와 특성을 해금하세요",
                    "  4. 창고 시스템으로 아이템을 수집하고 관리하세요",
                    "  5. 게임오버 시에도 아이템을 구출해 계속 성장하세요",
                    "",
                    "✨ 이 게임의 특별한 점:",
                    "  • FF 스타일 Brave 전투 시스템으로 전략적 전투",
                    "  • 28개 고유 직업과 240개+ 스킬의 무한한 조합",
                    "  • 죽어도 의미있는 메타 진행 시스템",
                    "  • 창고와 수집 시스템으로 끝없는 성장",
                    "",
                    "💡 첫 플레이 꿀팁:",
                    "  • 전사/성기사(탱커) + 아크메이지/궁수(딜러) 조합 추천",
                    "  • Brave는 300-500 모으고 HP 공격하세요",
                    "  • 죽어도 별조각을 얻으니 과감하게 도전하세요!"
                ],
                "difficulty": "초급",
                "estimated_time": "3분",
                "category": "basic"
            },
            
            "Brave_완전정복": {
                "title": "⚡ Brave 시스템 완전 정복 - FF 스타일 전투의 정수",
                "description": "게임의 핵심! 한 번 이해하면 전투가 재미있어집니다",
                "content": [
                    "🎯 Brave 시스템이란?",
                    "  → Final Fantasy의 전략적 전투 시스템을 로그라이크에 완벽 적용!",
                    "",
                    "📊 쉬운 비유로 이해하기:",
                    "  • Brave = 활을 당기는 힘 (포텐셜 에너지)",
                    "  • HP 공격 = 화살을 발사하기 (운동 에너지)",
                    "  • 더 많이 당길수록 더 강한 화살이 날아갑니다!",
                    "",
                    "🔄 전투 플로우 3단계:",
                    "  1. **BRV 공격**: 적의 BRV를 깎고 내 BRV를 올립니다",
                    "     └ 상대방을 약화시키면서 내 공격력 충전!",
                    "  2. **BRV 축적**: 300-800 정도 모을 때까지 반복",
                    "     └ 초보자는 500 정도면 충분해요!",
                    "  3. **HP 공격**: 모든 BRV를 소모해서 실제 피해!",
                    "     └ 드디어 상대방의 HP를 깎는 결정타!",
                    "",
                    "💥 Break 시스템 - 게임 체인저:",
                    "  • 상대방의 BRV가 0 이하가 되면 'Break' 상태",
                    "  • Break된 적은 HP 공격 피해를 더 많이 받습니다!",
                    "  • Break를 노려보세요 - 일발역전의 기회!",
                    "",
                    "🧬 상처 시스템 - 진짜 생존게임:",
                    "  • 받은 HP 피해의 25%가 '상처'로 누적",
                    "  • 상처는 최대 HP를 줄입니다 (최대 75%까지)",
                    "  • 단순 회복으론 완전히 못 낫습니다!",
                    "  • 초과 회복의 25%로만 상처가 치료됩니다",
                    "",
                    "✨ 초보자 실전 가이드:",
                    "  1. 처음엔 BRV 공격만 계속 사용",
                    "  2. BRV가 400-600 모이면 HP 공격",
                    "  3. 적의 BRV를 0으로 만들어 Break 유발",
                    "  4. Break된 적에게 바로 HP 공격!",
                    "",
                    "✨ 프로 팁:",
                    "  • ATB 게이지를 보면서 턴 순서 파악",
                    "  • 캐스팅 중인 적을 공격해서 방해하기",
                    "  • 직업별로 BRV/HP 공격 특성이 다름!"
                ],
                "difficulty": "초급",
                "estimated_time": "5분",
                "category": "combat"
            },
            
            "직업_시스템_입문": {
                "title": "🎭 28개 직업 시스템 - 무한한 조합의 세계",
                "description": "각자 다른 특성을 가진 28개 직업의 세계로!",
                "content": [
                    "🌟 28개 직업, 무한한 가능성!",
                    "  → 모든 직업이 독특한 플레이 스타일을 제공합니다",
                    "",
                    "🏆 기본 4개 직업 (시작 시 해금):",
                    "  • **전사**: 적응형 자세 시스템, 상황에 맞게 변신!",
                    "    └ 공격형/방어형/균형/광전사/수호자 자세 변경 가능",
                    "  • **아크메이지**: 강력한 마법의 대가, 원소 마스터",
                    "    └ 마력 파동으로 광역 피해, 마력 폭발로 마무리",
                    "  • **궁수**: 조준 시스템과 지원사격의 달인",
                    "    └ 조준 포인트로 정확도 증가, 지원사격으로 추가 공격",
                    "  • **도적**: 맹독 시스템의 마스터, 96스택 독의 공포",
                    "    └ 독 중첩 + 독 촉진으로 순간 폭딜",
                    "",
                    "⚔️ 전투 직업군 (8개):",
                    "  • **성기사**: 신성한 빛의 수호자",
                    "  • **암흑기사**: 어둠의 힘을 다루는 기사",
                    "  • **몽크**: 표식 시스템으로 연계 공격",
                    "  • **바드**: 음표 사기 시스템으로 아군 강화",
                    "",
                    "🎩 마법 직업군 (10개):",
                    "  • **네크로맨서**: 생명력 조작의 대가",
                    "  • **용기사**: 화염과 점프의 기사",
                    "  • **검성**: 검기 시스템의 달인",
                    "  • **정령술사**: 원소의 힘을 빌리는 자",
                    "  • **시간술사**: 시간 조작의 마법사",
                    "  • **연금술사**: 폭발과 변환의 과학자",
                    "  • **차원술사**: 공간을 조작하는 마법사",
                    "  • **마검사**: 마법과 검술의 조화",
                    "  • **기계공학자**: 첨단 기술의 마스터",
                    "  • **무당**: 영혼과 소통하는 신비한 존재",
                    "",
                    "🗡️ 특수 직업군 (10개):",
                    "  • **암살자**: 그림자 시스템으로 은밀한 공격",
                    "  • **해적**: 이도류와 보물 시스템",
                    "  • **사무라이**: 명예와 일격필살",
                    "  • **드루이드**: 자연의 힘과 변신",
                    "  • **철학자**: 논리와 지혜의 힘",
                    "  • **검투사**: 관중의 환호가 힘이 되는 전사",
                    "  • **기사**: 기사도와 수호의 정신",
                    "  • **신관**: 신성한 치유와 축복",
                    "  • **광전사**: 분노와 광기의 전사",
                    "",
                    "🎯 초보자 추천 파티 구성:",
                    "  1. **균형잡힌 구성**: 전사(탱커) + 아크메이지(딜러) + 궁수(딜러) + 성기사(힐러)",
                    "  2. **물리 특화**: 전사 + 궁수 + 도적 + 몽크",
                    "  3. **마법 특화**: 아크메이지 + 네크로맨서 + 정령술사 + 신관",
                    "",
                    "💰 해금 시스템:",
                    "  • 별조각으로 새로운 직업 해금 (10-200 별조각)",
                    "  • 희귀한 직업일수록 더 많은 별조각 필요",
                    "  • 게임 플레이로 자연스럽게 별조각 획득!"
                ],
                "difficulty": "초급",
                "estimated_time": "7분",
                "category": "classes"
            },
            
            "메타_진행_완전_가이드": {
                "title": "⭐ 메타 진행 시스템 - 죽어도 계속 성장하는 시스템",
                "description": "게임의 진정한 재미! 한 번의 죽음도 헛되지 않습니다",
                "content": [
                    "🌟 메타 진행이란?",
                    "  → 캐릭터가 죽어도 계속 성장하는 영구 진행 시스템!",
                    "  → 매 플레이마다 더 강해지는 선순환 구조",
                    "",
                    "💎 별조각 - 모든 성장의 열쇠:",
                    "  • 게임 플레이로 획득하는 핵심 화폐",
                    "  • 적 처치, 층 클리어, 목표 달성으로 획득",
                    "  • 죽어도 별조각은 그대로 유지!",
                    "",
                    "🎭 캐릭터 해금 시스템:",
                    "  • 28개 직업을 별조각으로 하나씩 해금",
                    "  • 기본 4개 → 고급 8개 → 마스터 16개 순서",
                    "  • 각 직업마다 독특한 플레이 스타일 제공",
                    "",
                    "🧬 특성 해금 시스템:",
                    "  • 140개+ 특성으로 캐릭터 강화",
                    "  • 기본 특성(5-25 별조각) → 고급 특성(50-100 별조각)",
                    "  • 전설 특성(150+ 별조각)으로 궁극적 힘 획득",
                    "",
                    "🏪 창고 시스템 (신규!):",
                    "  • 100 별조각으로 창고 해금 가능",
                    "  • 6개 탭으로 체계적 아이템 관리",
                    "    └ 소모품/장비/무기/음식/재료/보물",
                    "  • 기본 10,000kg 무게 제한 (업그레이드 가능)",
                    "  • 탭당 100개 슬롯 (확장 가능)",
                    "",
                    "💀 게임오버 수집 시스템 (신규!):",
                    "  • 50 별조각으로 해금 가능",
                    "  • 게임오버 시 인벤토리에서 아이템 선택해서 구출",
                    "  • 기본 1개 → 최대 6개까지 업그레이드 가능",
                    "  • 구출한 아이템은 자동으로 창고에 저장",
                    "",
                    "🛠️ 영구 강화 시스템:",
                    "  • 기본 능력치 영구 증가",
                    "  • 특수 능력 해금 (자동 저장, 시작 보너스 등)",
                    "  • 게임 편의성 향상 기능들",
                    "",
                    "🏆 업적 시스템:",
                    "  • 다양한 도전과제 달성",
                    "  • 업적 달성 시 별조각과 특별 보상",
                    "  • 숨겨진 업적도 많이 있어요!",
                    "",
                    "🎯 초보자 메타 진행 로드맵:",
                    "  1. **1차 목표**: 창고 해금 (100 별조각)",
                    "  2. **2차 목표**: 게임오버 수집 해금 (50 별조각)",
                    "  3. **3차 목표**: 선호 직업 해금 (10-50 별조각)",
                    "  4. **4차 목표**: 기본 특성들 해금 (5-25 별조각)",
                    "  5. **장기 목표**: 고급 특성과 레어 직업 해금",
                    "",
                    "💡 메타 진행 꿀팁:",
                    "  • 첫 플레이는 창고 해금을 목표로!",
                    "  • 게임오버 수집으로 좋은 아이템 보존",
                    "  • 다양한 직업을 시도해보며 취향 발견",
                    "  • 특성은 플레이 스타일에 맞게 선택"
                ],
                "difficulty": "중급",
                "estimated_time": "8분", 
                "category": "meta"
            },
            
            "첫_전투_가이드": {
                "title": "⚔️ 첫 전투 완전 정복 - 무서워하지 마세요!",
                "description": "실전으로 배우는 Brave 전투 시스템",
                "content": [
                    "🎮 첫 전투 시뮬레이션!",
                    "  → 실제 상황을 가정해서 단계별로 배워봅시다",
                    "",
                    "👥 상황 설정:",
                    "  • 우리 파티: 전사(HP 100, BRV 50)",
                    "  • 적: 고블린(HP 80, BRV 30)",
                    "  • ATB 게이지로 턴 순서 결정",
                    "",
                    "🔄 전투 진행 단계별 가이드:",
                    "",
                    "**1턴: 전사의 차례**",
                    "  📊 현재 상황: BRV 50 (아직 부족함)",
                    "  🎯 선택: '방패 강타' (BRV 공격) 사용",
                    "  📈 결과: 적 BRV 30→10, 내 BRV 50→120",
                    "  💡 해설: 적을 약화시키면서 내 힘 축적!",
                    "",
                    "**2턴: 고블린의 차례**", 
                    "  🗡️ 고블린이 '발톱 공격' 사용",
                    "  📉 결과: 전사 BRV 120→80 (BRV가 깎였지만 괜찮음)",
                    "",
                    "**3턴: 전사의 차례**",
                    "  📊 현재 상황: BRV 80 (아직 좀 더 모으자)",
                    "  🎯 선택: '파괴의 일격' (강한 BRV 공격) 사용",
                    "  📈 결과: 적 BRV 10→-20 (Break 발생!), 내 BRV 80→200",
                    "  🎉 Break 상태: 고블린이 무력화됨!",
                    "",
                    "**4턴: 전사의 차례 (Break 상태 지속)**",
                    "  📊 현재 상황: BRV 200, 적이 Break 상태",
                    "  🎯 선택: 'HP 공격' 사용 (최적의 타이밍!)",
                    "  💥 결과: 고블린 HP 80→15 (Break 보너스로 큰 피해!)",
                    "  📉 부작용: 내 BRV 200→50 (HP 공격 후 BRV 감소)",
                    "",
                    "**5턴: 고블린 차례**",
                    "  🔄 고블린 BRV가 기본값으로 회복 (INT BRV)",
                    "  ⚡ 하지만 HP가 15라서 약해진 상태",
                    "",
                    "**6턴: 전사의 차례**",
                    "  🎯 마무리: 한 번 더 BRV 모으고 HP 공격으로 처치!",
                    "",
                    "🎓 이 전투에서 배운 핵심:",
                    "  1. **BRV 관리**: 300-500 정도 모으고 HP 공격",
                    "  2. **Break 활용**: 적의 BRV를 0 이하로 만들어 무력화",
                    "  3. **타이밍**: Break 상태일 때 HP 공격이 최고 효율",
                    "  4. **지속성**: 한 번의 HP 공격으로 끝나지 않을 수 있음",
                    "",
                    "⚠️ 초보자 주의사항:",
                    "  • 너무 조급해하지 마세요 - BRV를 충분히 모으세요",
                    "  • 적의 강한 공격이 올 것 같으면 방어도 고려",
                    "  • 여러 적이 있을 때는 위험한 적부터 처치",
                    "  • MP 0인 기본 공격을 적극 활용하세요",
                    "",
                    "🏆 실전 팁:",
                    "  • 캐스팅 중인 적을 공격해서 방해하기",
                    "  • ATB 게이지 보면서 턴 순서 예측",
                    "  • 각 직업의 고유 시스템 활용하기",
                    "",
                    "🩸 상처 시스템도 알아두세요:",
                    "  • 받은 데미지의 25%가 상처로 누적됩니다",
                    "  • 상처는 최대 HP를 제한해요 (최대 75%까지)",
                    "  • 초과 치유량의 25%로만 상처가 치유됩니다"
                ],
                "difficulty": "초급", 
                "estimated_time": "6분",
                "category": "combat"
            },
            
            "캐릭터_고르기_도움": {
                "title": "👥 28개 직업 중 어떤 캐릭터를 골라야 할까요?",
                "description": "초보자를 위한 캐릭터 선택 완전 가이드",
                "content": [
                    "🤔 28명 중에 어떻게 고르죠?",
                    "  → 걱정 마세요! 체계적인 선택 가이드를 알려드릴게요",
                    "",
                    "🌟 기본 해금 4개 직업 (별조각 불필요):",
                    "  ⚔️ **전사**: 적응형 자세 시스템의 만능 탱커",
                    "    └ 공격형/방어형/균형/광전사/수호자 자세 변경",
                    "  🔮 **아크메이지**: 원소 마법의 대가, 광역 딜러",
                    "    └ 마력 파동으로 BRV, 마력 폭발으로 마무리",
                    "  🏹 **궁수**: 조준과 지원사격의 정밀 딜러",
                    "    └ 조준 포인트로 정확도 증가, 지원사격 추가",
                    "  🗡️ **도적**: 맹독 시스템의 DoT 스페셜리스트",
                    "    └ 96스택 독 중첩, 독 촉진으로 폭발 딜",
                    "",
                    "🏆 초보자 최강 추천 파티:",
                    "  1. **전사** (메인 탱커) - 방어형 자세로 파티 보호",
                    "  2. **아크메이지** (마법 딜러) - 강력한 원소 마법",
                    "  3. **궁수** (물리 딜러) - 안정적인 원거리 공격",
                    "  4. **성기사** (힐서포터) - 치유와 성스러운 보호",
                    "",
                    "💰 별조각으로 해금하는 진화 로드맵:",
                    "",
                    "**🌟 1단계 (10-30 별조각): 기본 확장**",
                    "  • **성기사** (15): 신성한 치유와 언데드 특효",
                    "  • **암흑기사** (20): 생명 흡수와 어둠의 힘",
                    "  • **몽크** (18): 표식 시스템과 연환 타격",
                    "  • **바드** (22): 음표 사기로 파티 전체 강화",
                    "",
                    "**⭐ 2단계 (35-60 별조각): 전문가**",
                    "  • **네크로맨서** (35): 생명력 조작과 언데드 소환",
                    "  • **용기사** (40): 화염 브레스와 점프 공격",
                    "  • **검성** (45): 검기 시스템과 일섬 필살",
                    "  • **정령술사** (50): 원소 융합과 정령 소환",
                    "",
                    "**🌟 3단계 (70-120 별조각): 고급 스페셜리스트**",
                    "  • **암살자** (75): 그림자 시스템과 은밀 공격",
                    "  • **기계공학자** (80): 레이저와 기계 제어",
                    "  • **무당** (85): 영혼 시야와 악령 퇴치",
                    "  • **해적** (70): 이도류 난타와 보물 발견",
                    "",
                    "**✨ 4단계 (130-200 별조각): 마스터 클래스**",
                    "  • **사무라이** (130): 명예와 일격필살의 도",
                    "  • **드루이드** (140): 자연 변신과 동물 친화",
                    "  • **철학자** (150): 논리적 사고와 진리 탐구",
                    "  • **연금술사** (160): 폭발 연구와 물질 변환",
                    "  • **검투사** (170): 관중의 환호와 콜로세움 기술",
                    "  • **기사** (180): 기사도 정신과 수호의 맹세",
                    "  • **신관** (190): 신성한 치유와 축복의 기도",
                    "  • **광전사** (200): 분노와 광기의 극한 전투",
                    "",
                    "**🌟 5단계 (250-400 별조각): 전설 등급**",
                    "  • **시간술사** (250): 시간 조작과 시공 왜곡",
                    "  • **마검사** (300): 마법과 검술의 완벽한 조화",
                    "  • **차원술사** (400): 공간 지배와 차원 이동",
                    "",
                    "🎯 역할별 추천 조합:",
                    "",
                    "**🛡️ 탱커 라인업:**",
                    "  • 초급: 전사 (적응형 자세)",
                    "  • 중급: 성기사 (신성한 보호)",
                    "  • 고급: 기사 (수호의 맹세)",
                    "",
                    "**⚔️ 물리 딜러:**",
                    "  • 초급: 궁수 (조준 시스템)",
                    "  • 중급: 검성 (검기 일섬)",
                    "  • 고급: 사무라이 (일격필살)",
                    "",
                    "**🔮 마법 딜러:**",
                    "  • 초급: 아크메이지 (원소 마법)",
                    "  • 중급: 정령술사 (원소 융합)",
                    "  • 고급: 시간술사 (시간 조작)",
                    "",
                    "**💚 힐서포터:**",
                    "  • 초급: 성기사 (신성한 치유)",
                    "  • 중급: 바드 (파티 버프)",
                    "  • 고급: 신관 (완벽한 치유)",
                    "",
                    "🎮 플레이 스타일별 추천:",
                    "  • **초보자**: 전사 + 아크메이지 + 궁수 + 성기사",
                    "  • **물리 특화**: 전사 + 궁수 + 도적 + 몽크",
                    "  • **마법 특화**: 아크메이지 + 네크로맨서 + 정령술사 + 바드",
                    "  • **하이브리드**: 전사 + 검성 + 정령술사 + 성기사",
                    "",
                    "💡 캐릭터 선택 팁:",
                    "  • 처음엔 기본 4개로 시스템 익히기",
                    "  • 별조각 모으면서 하나씩 추가",
                    "  • 특성 해금도 함께 고려하기",
                    "  • 취향에 맞는 플레이 스타일 발견하기"
                ],
                "difficulty": "초급",
                "estimated_time": "8분",
                "category": "characters"
            },
            
            "던전_탐험_기초": {
                "title": "🗺️ 던전 탐험 완전 마스터 - 생존의 기술",
                "description": "무한 던전을 탐험하는 모든 것",
                "content": [
                    "🏰 Dawn Of Stellar의 던전 시스템:",
                    "  → 절차적 생성으로 매번 다른 던전",
                    "  → 무한 층수로 끝없는 도전",
                    "  → 층마다 난이도와 보상 증가",
                    "",
                    "🚶‍♂️ 기본 이동과 조작:",
                    "  • **WASD 키** 또는 **방향키**로 이동",
                    "  • **스페이스바**로 턴 넘기기/대기",
                    "  • **G키**로 아이템 줍기",
                    "  • **F키**로 적과 전투",
                    "",
                    "🗺️ 던전 구조 이해하기:",
                    "  • **#**: 벽 - 지나갈 수 없음",
                    "  • **.**: 바닥 - 자유롭게 이동",
                    "  • **@**: 플레이어 (당신!)",
                    "  • **E**: 적 - 전투 발생",
                    "  • **>**: 계단 - 다음 층으로",
                    "",
                    "🎁 아이템 표시:",
                    "  • **!**: 소모품 (포션, 음식 등)",
                    "  • **L**: 무기 (검, 지팡이 등)",
                    "  • **]**: 방어구 (갑옷, 방패 등)",
                    "  • **Q**: 액세서리 (반지, 목걸이 등)",
                    "",
                    "🏛️ 특수 지형과 필드 스킬:",
                    "  • **=**: 보물상자 - 귀중한 아이템",
                    "  • **&**: 잠긴 문 - 도적/궁수의 자물쇠해제 필요",
                    "  • **?**: 비밀 문 - 도적/궁수/철학자의 비밀탐지 필요",
                    "  • **^**: 함정 - 도적/궁수의 함정탐지/해제 필요",
                    "  • **T**: 신성한 제단 - 성기사/신관의 신성마법 필요",
                    "  • **~**: 치유의 샘 - 누구나 이용 가능",
                    "  • **B**: 고대 서재 - 철학자/아크메이지의 지식탐구 필요",
                    "  • **F**: 마법 대장간 - 기계공학자의 기계공학 필요",
                    "  • **G**: 비밀 정원 - 드루이드의 자연친화 필요",
                    "  • *****: 마법 수정 - 정령술사/아크메이지의 정령술 필요",
                    "  • **/**: 수상한 레버 - 기계공학자/도적의 기계조작 필요",
                    "",
                    "💎 보물상자 시스템:",
                    "  • **일반상자**: 기본 아이템과 소량 골드",
                    "  • **마법상자**: 마법 아이템과 포션",
                    "  • **전설상자**: 희귀 장비와 특수 아이템",
                    "  • 함정이 있을 수 있으니 주의!",
                    "",
                    "⚠️ 함정 시스템:",
                    "  • **독 함정**: 독 상태이상 부여",
                    "  • **폭발 함정**: 즉시 피해",
                    "  • **순간이동 함정**: 무작위 위치로 이동",
                    "  • 도적의 직감 특성으로 감지 가능",
                    "",
                    "🛒 상점 이용하기:",
                    "  • 다양한 아이템 구매/판매",
                    "  • 장비 수리 서비스",
                    "  • 정보 구매 (맵, 적 정보)",
                    "  • 가격은 카리스마 특성으로 할인 가능",
                    "",
                    "🎒 인벤토리 관리 (I키):",
                    "  • **무게 제한**: 과부하 시 이동 속도 감소",
                    "  • **슬롯 제한**: 아이템 종류별 제한",
                    "  • **자동 정리**: 같은 아이템 자동 스택",
                    "  • 창고 해금 시 대용량 보관 가능",
                    "",
                    "🚨 20걸음 = 1턴 시스템:",
                    "  • 20걸음마다 필드 턴 진행",
                    "  • 자연 회복: HP/MP/상처 소량 회복",
                    "  • 상태이상도 1턴씩 감소",
                    "  • 랜덤 인카운터 발생 가능성",
                    "",
                    "🎲 랜덤 인카운터:",
                    "  • 보물 발견, 신비한 만남",
                    "  • 특별한 적과의 조우",
                    "  • 필드 스킬 사용 기회",
                    "  • 긍정적/부정적 이벤트 다양",
                    "",
                    "🏢 층 시스템 이해:",
                    "  • **1-5층**: 튜토리얼 구간, 기본 적들",
                    "  • **6-10층**: 중급 구간, 마법 적 등장",
                    "  • **11-20층**: 고급 구간, 엘리트 적 등장",
                    "  • **21층+**: 전문가 구간, 보스급 적들",
                    "  • **5의 배수 층**: 특별한 보스 출현",
                    "",
                    "🎯 탐험 전략:",
                    "  1. **완전 탐색**: 모든 방을 다 둘러보기",
                    "  2. **자원 관리**: HP/MP 아껴가며 진행",
                    "  3. **위험 회피**: 너무 강한 적은 피하기",
                    "  4. **아이템 우선순위**: 치유템 > 장비 > 기타",
                    "",
                    "💡 생존 꿀팁:",
                    "  • 체력 50% 이하면 즉시 회복",
                    "  • 무게 90% 이상 시 정리하기",
                    "  • 중요한 아이템은 창고에 보관",
                    "  • 상처 누적되면 초과 치유로 관리",
                    "  • 층 이동 전 상태 점검 필수",
                    "",
                    "🏆 고급 탐험 기술:",
                    "  • 미니맵(M키)으로 효율적 이동",
                    "  • 적 패턴 파악해서 유리한 전투",
                    "  • 필드 스킬로 특수 상황 해결",
                    "  • AI 모드로 자동 탐험 가능"
                ],
                "difficulty": "초급",
                "estimated_time": "10분",
                "category": "exploration"
            },
            
            "레벨업_성장_시스템": {
                "title": "📈 캐릭터 성장 & 메타 진행 완전 가이드",
                "description": "더 강해지는 모든 방법들",
                "content": [
                    "💪 캐릭터가 강해지는 4가지 방법:",
                    "",
                    "🎯 1. 기본 레벨업 시스템:",
                    "  • 적 처치로 경험치 획득",
                    "  • 레벨업 시 모든 기본 능력치 자동 증가",
                    "  • 새로운 스킬 해금 및 강화",
                    "  • 직업별 고유 성장 곡선",
                    "",
                    "⚔️ 2. 장비 시스템:",
                    "  • **희귀도**: 일반 → 마법 → 희귀 → 전설 → 신화",
                    "  • **인챈트**: 마법 부여로 특수 효과 추가",
                    "  • **세트 효과**: 같은 세트 착용 시 보너스",
                    "  • **내구도 관리**: 수리를 통한 성능 유지",
                    "",
                    "🌟 3. 메타 진행 시스템 (핵심!):",
                    "  **캐릭터 해금 (28개 직업)**:",
                    "  • 기본 4개 → 전투 8개 → 마법 10개 → 특수 6개",
                    "  • 10-400 별조각으로 단계적 해금",
                    "  • 각 직업마다 완전히 다른 플레이 스타일",
                    "",
                    "  **특성 해금 (140개+ 특성)**:",
                    "  • 기본 특성 (5-25 별조각): 기초 능력 강화",
                    "  • 고급 특성 (50-100 별조각): 전문적 능력",
                    "  • 전설 특성 (150+ 별조각): 게임 체인저급 능력",
                    "",
                    "  **창고 시스템 (100 별조각)**:",
                    "  • 10,000kg 대용량 저장공간",
                    "  • 6개 카테고리별 체계적 관리",
                    "  • 업그레이드로 용량 확장 가능",
                    "",
                    "  **게임오버 수집 (50 별조각)**:",
                    "  • 죽어도 아이템 구출 가능",
                    "  • 기본 1개 → 최대 6개까지 확장",
                    "  • 구출한 아이템 자동으로 창고 보관",
                    "",
                    "  **영구 강화 시스템**:",
                    "  • 기본 능력치 영구 증가",
                    "  • 자동 저장, 시작 보너스 등 편의 기능",
                    "  • 게임 플레이 편의성 대폭 향상",
                    "",
                    "🎭 4. 특성 시스템 (직업별 고유):",
                    "  • **패시브 특성**: 항상 발동 (예: 피의 갈증)",
                    "  • **조건부 특성**: 특정 상황에서 발동 (예: 불굴의 의지)",
                    "  • **액티브 특성**: 수동 사용 (예: 차원 이동)",
                    "  • 각 캐릭터당 최대 2개 선택 가능",
                    "",
                    "💎 별조각 획득 방법:",
                    "  • **층 클리어**: 깊이 갈수록 더 많이 (1-20개)",
                    "  • **적 처치**: 보스, 엘리트 적 처치 시 (2-10개)",
                    "  • **업적 달성**: 숨겨진 도전과제 (5-50개)",
                    "  • **퍼펙트 클리어**: 무피해 보너스 (2배)",
                    "  • **첫 발견**: 새로운 것 발견 시 추가 보상",
                    "",
                    "� 초보자 성장 로드맵:",
                    "  **1단계 (0-150 별조각)**:",
                    "  1. 창고 해금 (100) - 최우선!",
                    "  2. 게임오버 수집 해금 (50) - 아이템 보존",
                    "",
                    "  **2단계 (150-300 별조각)**:",
                    "  3. 선호 직업 해금 (10-50) - 플레이 스타일 확장",
                    "  4. 기본 특성 해금 (5-25) - 능력 강화",
                    "",
                    "  **3단계 (300-500 별조각)**:",
                    "  5. 창고/수집 업그레이드 (30-75) - 용량 확장",
                    "  6. 고급 특성 해금 (50-100) - 전문화",
                    "",
                    "  **4단계 (500+ 별조각)**:",
                    "  7. 레어 직업 해금 (150-400) - 마스터 클래스",
                    "  8. 전설 특성 해금 (150+) - 궁극 능력",
                    "",
                    "🏆 고급 성장 전략:",
                    "  • **다양성**: 여러 직업 시도해보며 취향 발견",
                    "  • **특화**: 선호 스타일에 집중 투자",
                    "  • **밸런스**: 공격/방어/지원 균형 고려",
                    "  • **장기 플래닝**: 목표 설정하고 계획적 성장",
                    "",
                    "💡 성장 꿀팁:",
                    "  • 죽음을 두려워하지 마세요 - 별조각은 남아요!",
                    "  • 창고와 수집 시스템을 적극 활용하세요",
                    "  • 새로운 직업은 과감하게 시도해보세요",
                    "  • 특성은 시너지를 고려해서 선택하세요"
                ],
                "difficulty": "중급",
                "estimated_time": "12분",
                "category": "meta"
            }
        }
    
    def show_main_menu(self) -> Optional[str]:
        """초보자 가이드 메인 메뉴"""
        print("\n" + "="*60)
        print("🔰 초보자 가이드 - Dawn Of Stellar 입문서")
        print("="*60)
        
        menu_options = []
        
        # 난이도별로 섹션 정리
        beginner_sections = []
        intermediate_sections = []
        advanced_sections = []
        
        for key, section in self.guide_sections.items():
            if section["difficulty"] == "초급":
                beginner_sections.append((key, section))
            elif section["difficulty"] == "중급":
                intermediate_sections.append((key, section))
            else:
                advanced_sections.append((key, section))
        
        # 초급 섹션들
        if beginner_sections:
            for key, section in beginner_sections:
                difficulty_icon = "🔰"
                option_text = f"{difficulty_icon} {section['title']}"
                detail_text = f"{section['description']}\n예상 시간: {section['estimated_time']} | 난이도: {section['difficulty']}"
                menu_options.append({'text': option_text, 'detail': detail_text, 'value': key})
        
        # 중급 섹션들  
        if intermediate_sections:
            for key, section in intermediate_sections:
                difficulty_icon = "⭐"
                option_text = f"{difficulty_icon} {section['title']}"
                detail_text = f"{section['description']}\n예상 시간: {section['estimated_time']} | 난이도: {section['difficulty']}"
                menu_options.append({'text': option_text, 'detail': detail_text, 'value': key})
        
        # 고급 섹션들
        if advanced_sections:
            for key, section in advanced_sections:
                difficulty_icon = "🏆"
                option_text = f"{difficulty_icon} {section['title']}"
                detail_text = f"{section['description']}\n예상 시간: {section['estimated_time']} | 난이도: {section['difficulty']}"
                menu_options.append({'text': option_text, 'detail': detail_text, 'value': key})
        
        # 추가 옵션들
        menu_options.extend([
            {
                'text': "📖 전체 가이드 보기",
                'detail': "모든 가이드를 순서대로 봅니다",
                'value': "show_all"
            },
            {
                'text': "⚡ 빠른 시작 가이드",
                'detail': "꼭 필요한 내용만 빠르게 확인합니다",
                'value': "quick_start"
            },
            {
                'text': "🎮 실제 게임 시작하기",
                'detail': "가이드를 마치고 본격적으로 게임을 시작합니다",
                'value': "start_game"
            },
            {
                'text': "❓ 자주 묻는 질문 (FAQ)",
                'detail': "초보자들이 자주 궁금해하는 내용들",
                'value': "faq"
            },
            {
                'text': "🚪 나가기",
                'detail': "가이드를 종료하고 메인 메뉴로 돌아갑니다",
                'value': "exit"
            }
        ])
        
        menu = CursorMenu(
            title="초보자 가이드 선택",
            options=[opt['text'] for opt in menu_options],
            descriptions=[opt['detail'] for opt in menu_options]
        )
        
        choice_index = menu.run()
        if choice_index is not None and 0 <= choice_index < len(menu_options):
            return menu_options[choice_index]['value']
        return None
    
    def show_section(self, section_key: str):
        """특정 섹션 표시"""
        if section_key not in self.guide_sections:
            print("❌ 해당 가이드를 찾을 수 없습니다.")
            return
            
        section = self.guide_sections[section_key]
        
        print("\n" + "="*60)
        print(f"📖 {section['title']}")
        print("="*60)
        print(f"💡 {section['description']}")
        print(f"⏱️ 예상 시간: {section['estimated_time']} | 📊 난이도: {section['difficulty']}")
        print("-"*60)
        
        # 타이핑 효과로 내용 표시 - 한 글자씩 천천히
        line_count = 0
        for line in section['content']:
            if line.strip() == "":  # 빈 줄은 그냥 출력
                print()
            else:
                typewriter_effect(line, delay=0.04)  # 한 글자당 0.04초
            
            line_count += 1
            
            # 3-4줄마다 사용자 입력 대기
            if line_count % 4 == 0 and line.strip() != "":
                if not wait_for_user_input("📖 계속 읽으려면 Enter를 누르세요... (Ctrl+C로 건너뛰기)"):
                    break
                    
        print("\n" + "-"*60)
        
        # 진행 옵션
        menu_options = [
            {'text': "✅ 이해했습니다", 'detail': "다음 단계로 진행합니다", 'value': "understood"},
            {'text': "🔄 다시 읽기", 'detail': "이 가이드를 다시 봅니다", 'value': "reread"},
            {'text': "🏠 가이드 메뉴로", 'detail': "가이드 메인 메뉴로 돌아갑니다", 'value': "menu"}
        ]
        
        menu = CursorMenu(
            title="다음 단계 선택",
            options=[opt['text'] for opt in menu_options],
            descriptions=[opt['detail'] for opt in menu_options]
        )
        
        choice_index = menu.run()
        if choice_index is not None and 0 <= choice_index < len(menu_options):
            choice = menu_options[choice_index]['value']
        else:
            choice = None
        
        if choice == "reread":
            self.show_section(section_key)
        elif choice == "understood":
            self.mark_completed(section_key)
            print(f"✅ '{section['title']}' 완료!")
            input("계속하려면 Enter를 누르세요...")
        
        return choice
    
    def show_all_guides(self):
        """전체 가이드 순서대로 보기"""
        typewriter_effect("\n🌟 전체 가이드를 시작합니다!")
        typewriter_effect("필요하면 언제든지 건너뛸 수 있어요.")
        
        wait_for_user_input()
        
        # 초급 → 중급 → 고급 순서로 정렬
        ordered_sections = []
        for key, section in self.guide_sections.items():
            if section["difficulty"] == "초급":
                ordered_sections.append((key, section, 1))
            elif section["difficulty"] == "중급":
                ordered_sections.append((key, section, 2))
            else:
                ordered_sections.append((key, section, 3))
        
        ordered_sections.sort(key=lambda x: x[2])
        
        for i, (key, section, _) in enumerate(ordered_sections, 1):
            typewriter_effect(f"\n📍 가이드 {i}/{len(ordered_sections)}: {section['title']}")
            result = self.show_section(key)
            if result == "menu":
                break
    
    def show_quick_start(self):
        """빠른 시작 가이드"""
        quick_sections = ["게임_소개", "Brave_쉽게_이해하기", "첫_전투_가이드", "던전_탐험_기초"]
        
        typewriter_effect("\n⚡ 빠른 시작 가이드")
        typewriter_effect("게임 시작에 꼭 필요한 내용만 보여드릴게요!")
        
        wait_for_user_input()
        
        for i, key in enumerate(quick_sections, 1):
            if key in self.guide_sections:
                section = self.guide_sections[key]
                typewriter_effect(f"\n📍 필수 가이드 {i}/{len(quick_sections)}: {section['title']}")
                result = self.show_section(key)
                if result == "menu":
                    break
        
        typewriter_effect("\n🎉 빠른 시작 가이드 완료!")
        typewriter_effect("이제 게임을 시작할 준비가 되었어요!")
        input("Enter를 눌러 계속하세요...")
    
    def show_faq(self):
        """자주 묻는 질문"""
        faq_data = [
            {
                "question": "❓ 게임이 너무 어려워요!",
                "answer": [
                    "😊 괜찮습니다! 처음엔 모두 어려워해요.",
                    "",
                    "🎯 쉽게 시작하는 방법:",
                    "  • 쉬운 난이도로 시작하기",
                    "  • 추천 파티 구성 사용하기",
                    "  • Brave 공격 위주로 안전하게 플레이",
                    "  • 체력이 낮으면 주저 없이 아이템 사용",
                    "",
                    "💡 기억하세요: 실패해도 다시 시작할 수 있어요!"
                ]
            },
            {
                "question": "❓ 어떤 캐릭터를 선택해야 하나요?",
                "answer": [
                    "🌟 초보자 추천 조합:",
                    "  1. 전사 (앞에서 버티기)",
                    "  2. 검사 (안정적인 딜링)",
                    "  3. 성기사 (회복 담당)",
                    "  4. 마법사 (마법 공격)",
                    "",
                    "💫 고급자 추천:",
                    "  • 자신만의 조합을 실험해보세요!",
                    "  • 각 직업의 특성을 활용한 전략",
                    "  • 상황에 맞는 캐릭터 교체"
                ]
            },
            {
                "question": "❓ Brave 시스템이 헷갈려요!",
                "answer": [
                    "🎯 간단하게 생각해보세요:",
                    "",
                    "1️⃣ Brave 공격 = 데미지 충전",
                    "2️⃣ HP 공격 = 실제 데미지",
                    "",
                    "🔄 기본 패턴:",
                    "  Brave → Brave → HP → 반복",
                    "",
                    "⚡ 중요한 숫자: 300",
                    "  → 300 이상에서 HP 공격하면 효과적!"
                ]
            },
            {
                "question": "❓ 전투에서 계속 져요!",
                "answer": [
                    "💪 승리를 위한 팁:",
                    "",
                    "🛡️ 방어적 플레이:",
                    "  • 체력이 절반 이하면 치유",
                    "  • 확실하지 않으면 방어 선택",
                    "  • 무리하지 말고 안전하게",
                    "",
                    "⚔️ 공격적 플레이:",
                    "  • 상대방을 Break 상태로 만들기",
                    "  • Break 후 HP 공격으로 큰 데미지",
                    "  • 스킬을 적절히 활용"
                ]
            },
            {
                "question": "❓ 게임 조작이 어려워요!",
                "answer": [
                    "🎮 기본 조작법:",
                    "",
                    "🗺️ 이동: WASD 키",
                    "📋 인벤토리: I 키",
                    "👥 파티 상태: P 키",
                    "🔧 필드 활동: F 키",
                    "❓ 도움말: H 키",
                    "",
                    "💡 팁: 모르겠으면 H키를 눌러보세요!",
                    "언제든지 도움말을 볼 수 있어요."
                ]
            }
        ]
        
        print("\n" + "="*60)
        print("❓ 자주 묻는 질문 (FAQ)")
        print("="*60)
        
        for i, faq in enumerate(faq_data, 1):
            typewriter_effect(f"\n{i}. {faq['question']}")
            print("-" * 40)
            
            line_count = 0
            for line in faq['answer']:
                if line.strip() == "":  # 빈 줄은 그냥 출력
                    print()
                else:
                    typewriter_effect(line, delay=0.03)
                
                line_count += 1
                
                # 3줄마다 잠시 멈춤
                if line_count % 3 == 0 and line.strip() != "":
                    time.sleep(0.5)
                    
            wait_for_user_input("📖 다음 질문을 보려면 Enter를 누르세요...")
                
        wait_for_user_input("\n📖 FAQ를 모두 읽으셨으면 Enter를 누르세요...")
    
    def mark_completed(self, section_key: str):
        """섹션 완료 표시"""
        self.current_progress += 1
        # 여기에 진행 상황 저장 로직 추가 가능
    
    def run(self):
        """초보자 가이드 실행"""
        typewriter_effect("\n🌟 Dawn Of Stellar 초보자 가이드를 시작합니다!")
        typewriter_effect("💡 천천히 따라오시면 게임을 쉽게 배울 수 있어요!")
        
        wait_for_user_input()
        
        while True:
            choice = self.show_main_menu()
            
            if choice == "exit":
                typewriter_effect("\n👋 초보자 가이드를 종료합니다. 즐거운 게임 되세요!")
                break
            elif choice == "start_game":
                typewriter_effect("\n🎮 게임을 시작합니다! 화이팅!")
                return "start_game"
            elif choice == "faq":
                self.show_faq()
            elif choice == "show_all":
                self.show_all_guides()
            elif choice == "quick_start":
                self.show_quick_start()
            elif choice in self.guide_sections:
                result = self.show_section(choice)
                if result == "menu":
                    continue
            elif choice is None:
                typewriter_effect("\n👋 초보자 가이드를 종료합니다.")
                break


# 전역 인스턴스
integrated_beginner_guide = IntegratedBeginnerGuide()
