#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import re
import os
import time

def create_skill_tags_system():
    """스킬의 실제 효과에 기반한 정확한 태그 시스템 생성"""
    file_path = "game/new_skill_system.py"
    
    # 백업 생성
    backup_path = f"{file_path}.backup_tags_{int(time.time())}"
    os.system(f'copy "{file_path}" "{backup_path}"')
    print(f"백업 파일 생성: {backup_path}")
    
    with open(file_path, 'r', encoding='utf-8') as f:
        content = f.read()
    
    # 스킬별 정확한 태그 생성 - 실제 데이터에 기반
    skill_tag_mapping = {
        # 전사
        "방패강타": "[BRV:112] [기절:30%] [물리] MP:3",
        "철벽방어": "[방어+15%] [4턴] MP:4",
        "연속베기": "[BRV:84×2] [연속공격] [물리] MP:5", 
        "전투함성": "[전체 공격+12%] [5턴] MP:6",
        "파괴의일격": "[HP:125] [관통] [물리] [시전:15] MP:8",
        "전사의격노": "[궁극] [HP:168] [광폭화] [쿨:6턴] MP:15",
        
        # 검성
        "검기응축": "[공격+20%] [5턴] MP:3",
        "일섬": "[BRV:118] [크리+20%] [명중:98%] MP:4",
        "검압베기": "[BRV:140] [검압] [물리] MP:6",
        "검심일체": "[집중+30%] [6턴] MP:5",
        "무쌍베기": "[HP:147] [크리+15%] [시전:16] MP:9",
        "검제비의": "[궁극] [전체 HP:161] [침묵:3턴] [쿨:7턴] MP:17",
        
        # 검투사
        "투기장의기술": "[BRV] [격투] [물리] MP:3",
        "군중의함성": "[전체 사기증진] [버프] MP:4",
        "네트던지기": "[속도감소] [속박] MP:3",
        "트라이던트찌르기": "[HP] [관통] [물리] MP:6",
        "결투자의명예": "[특수효과] [명예] MP:5",
        "콜로세움의왕": "[궁극] [압도] [지배] MP:20",
        
        # 광전사
        "광기의씨앗": "[광기상태] [특수변환] MP:3",
        "무모한돌격": "[HP] [돌진] [무모] MP:5",
        "피의갈증": "[생명흡수] [갈증] MP:4",
        "광란의연타": "[연속공격] [광란] MP:6",
        "분노폭발": "[BRV+HP] [분노] [폭발] MP:8",
        "버서커의최후": "[궁극] [최후발악] [극한] MP:25",
        
        # 기사
        "방패방어": "[방어+25%] [방패] MP:4",
        "창돌격": "[BRV] [돌격] [창] MP:4",
        "아군보호": "[전체 방어증가] [보호] MP:5",
        "기사도정신": "[전능력+10%] [기사도] MP:6",
        "성스러운돌격": "[HP] [성스러운] [돌격] MP:8",
        "수호기사의맹세": "[궁극] [수호] [맹세] [완전보호] MP:20",
        
        # 성기사
        "신앙의힘": "[성스러운힘] [신앙] MP:3",
        "성스러운타격": "[BRV] [성스러운] [정화] MP:4",
        "축복": "[축복상태] [보호막] MP:5",
        "치유의빛": "[HP회복] [성스러운빛] MP:6",
        "부활": "[부활] [기적] MP:15",
        "천사의강림": "[궁극] [천사] [강림] [신성] MP:25",
        
        # 암흑기사
        "어둠의계약": "[어둠계약] [특수능력] MP:5",
        "생명흡수": "[BRV] [생명흡수] [어둠] MP:4",
        "저주의검": "[저주] [어둠] MP:5",
        "어둠의보호": "[어둠보호막] [방어증가] MP:4",
        "흡혈": "[HP] [생명흡수] [회복] MP:6",
        "어둠의지배자": "[궁극] [어둠지배] [압도] MP:20",
        
        # 용기사
        "용의비늘": "[방어+30%] [용의힘] MP:4",
        "드래곤클로": "[BRV] [용발톱] [찢기] MP:5",
        "화염숨결": "[BRV] [화염속성] [숨결] MP:5",
        "용의위엄": "[위압] [공방감소] [두려움] MP:6",
        "드래곤스피어": "[HP] [용의창] [관통] MP:10",
        "드래곤로드": "[궁극] [용군주] [화염폭풍] MP:22",
        
        # 아크메이지
        "마력파동": "[BRV] [마력] [파동] MP:4",
        "원소융합": "[BRV] [원소융합] [마법] MP:6",
        "마나실드": "[마법방어막] [마나흡수] MP:5",
        "마법폭발": "[HP] [마법폭발] [범위] MP:10",
        "시공술": "[시공조작] [행동제한] MP:8",
        "아르카나": "[궁극] [비밀마법] [최고위] MP:25",
        
        # 정령술사
        "정령교감": "[원소마법+25%] [정령교감] MP:4",
        "화염정령": "[BRV] [화염정령] [소환] MP:5",
        "물정령치유": "[HP회복] [물정령] [치유] MP:6",
        "바람정령축복": "[속도+20%] [회피+15%] MP:5",
        "대지정령분노": "[HP] [대지정령] [분노] MP:8",
        "사대정령소환": "[궁극] [4대정령] [원소폭풍] MP:20",
        
        # 시간술사
        "시간가속": "[속도+50%] [시간가속] MP:6",
        "시간왜곡": "[시간왜곡] [특수효과] MP:8",
        "시간되돌리기": "[상태복원] [시간역행] MP:12",
        "미래예지": "[회피+30%] [명중+25%] MP:7",
        "시간정지": "[전체정지] [필드] MP:15",
        "시공간붕괴": "[궁극] [시공붕괴] [절대] MP:30",
        
        # 차원술사
        "차원장막": "[물리회피+50%] [차원막] MP:5",
        "잔상분신": "[회피+40%] [분신] MP:6",
        "공간도약": "[BRV] [순간이동] [기습] MP:5",
        "차원미로": "[혼란] [이동봉인] MP:8",
        "회피반격": "[반격] [회피시발동] MP:7",
        "무적의경지": "[궁극] [무적] [차원초월] MP:25",
        
        # 철학자
        "진리탐구": "[지혜+30%] [마법력+25%] MP:5",
        "진실간파": "[적정보공개] [약점노출] MP:6",
        "지혜의빛": "[전체 지능+20%] [통찰] MP:7",
        "존재부정": "[HP] [논리공격] [존재부정] MP:12",
        "철학적사고": "[특수통찰] [유리효과] MP:8",
        "절대진리": "[궁극] [절대지혜] [진리] MP:28",
        
        # 궁수
        "연사": "[BRV] [연속사격] [원거리] MP:3",
        "관통사격": "[HP] [관통] [직선] MP:6",
        "독화살": "[BRV] [독:3턴] [화살] MP:4",
        "폭발화살": "[HP] [폭발] [범위] MP:8",
        "바람보조": "[명중+15%] [크리+10%] MP:4",
        "헌터모드": "[궁극] [완벽사격] [사냥꾼] MP:18",
        
        # 도적
        "그림자숨기": "[은신] [회피+60%] MP:4",
        "기습": "[BRV] [은신공격] [크리+25%] MP:5",
        "독바르기": "[다음공격 독추가] [무기강화] MP:3",
        "연막탄": "[시야차단] [명중-30%] MP:5",
        "암살술": "[HP] [크리확정] [암살] MP:10",
        "그림자분신": "[궁극] [분신술] [다중공격] MP:20",
        
        # 암살자
        "독침": "[BRV] [독:5턴] [침] MP:3",
        "암살": "[HP] [급소공격] [치명타] MP:8",
        "연막탄": "[전체 명중-40%] [연막] MP:6",
        "독무": "[전체 독:4턴] [필드독] MP:12",
        "독날투척": "[BRV] [독:3턴] [투척] MP:4",
        "독왕의비의": "[궁극] [치명독] [독왕] MP:22",
        
        # 해적
        "이도류": "[공격+25%] [이도류] MP:4",
        "칼부림": "[BRV] [난타] [연속] MP:5",
        "바다의저주": "[행동력-50%] [저주] MP:6",
        "해적의함성": "[전체 공격+15%] [사기] MP:5",
        "해상치료술": "[전체 HP회복] [바다치유] MP:10",
        "폭풍의함대": "[궁극] [전체 HP:133] [공포] [물속성] MP:17",
        
        # 사무라이
        "무사도": "[전능력+12%] [무사도] MP:3",
        "거합베기": "[BRV] [발도] [크리+30%] MP:5",
        "명상": "[HP+MP회복] [정신집중] MP:4",
        "진검승부": "[반격+100%] [진검] MP:7",
        "사무라이치유법": "[전체치유] [전통의술] MP:8",
        "오의무상베기": "[궁극] [무상베기] [절대] MP:20",
        
        # 바드 (모든 스킬이 지원형)
        "용기의노래": "[전체 공격+10% 크리+15%] [4턴] MP:4",
        "회복의선율": "[전체 HP회복:2.1] [재생:3턴] MP:6",
        "절망의노래": "[전체 공포+공격-10%] [절망] MP:5",
        "신속의리듬": "[전체 속도+20% 헤이스트] [4턴] MP:6",
        "천상의치유가": "[전체 대치유:4.5] [상태해제] MP:8",
        "천상의합창": "[궁극] [전체 치유:5.9] [무적:2턴] MP:22",
        
        # 무당
        "정령소환": "[수호정령] [전능력증가] MP:5",
        "저주의인형": "[다중저주] [인형술] MP:6",
        "치유의춤": "[전체 HP회복] [신성춤] MP:7",
        "영혼파악": "[적정보] [영혼투시] MP:4",
        "정령치유술": "[강력전체치유] [정령력] MP:10",
        "대자연의심판": "[궁극] [자연심판] [정령분노] MP:25",
        
        # 드루이드
        "자연교감": "[자연마법+30%] [교감] MP:4",
        "가시덩굴": "[이동제한] [지속피해] MP:5",
        "자연치유": "[HP회복] [상태해제] MP:6",
        "동물변신": "[변신] [능력변화] MP:8",
        "번개폭풍": "[HP] [번개] [폭풍] MP:12",
        "가이아의분노": "[궁극] [자연재해] [가이아] MP:28",
        
        # 신관
        "신의가호": "[전체 전능력+15%] [신의축복] MP:6",
        "성스러운빛": "[BRV] [정화] [성스러운] MP:4",
        "대치유술": "[전체 대회복] [신성마법] MP:10",
        "부활술": "[완전부활] [기적] MP:20",
        "신벌": "[HP] [신의벌] [성스러운] MP:12",
        "천국의문": "[궁극] [천국문] [신개입] MP:30",
        
        # 수도승
        "평화의기도": "[전체 정신력+20%] [평화] MP:5",
        "정화의빛": "[전상태해제] [정화] MP:8",
        "신성한치유": "[HP회복] [축복추가] MP:7",
        "침묵의서약": "[마법봉인] [침묵] MP:6",
        "순교자의길": "[자기희생] [전체강화] MP:15",
        "신의심판": "[궁극] [신심판] [악처벌] MP:25",
        
        # 몽크
        "기수련": "[내력증진] [기단련] MP:3",
        "연속주먹": "[BRV] [연속타격] [격투] MP:4",
        "명상": "[HP+MP회복] [명상] MP:5",
        "기폭발": "[HP] [내력폭발] [기] MP:8",
        "철의주먹": "[HP] [강철주먹] [관통] MP:10",
        "깨달음의경지": "[궁극] [무술극한] [깨달음] MP:22",
        
        # 마검사
        "마검각성": "[마법+검술강화] [각성] MP:5",
        "마법검격": "[BRV] [마법검] [융합] MP:5",
        "원소부여": "[무기원소강화] [부여] MP:4",
        "마검진": "[필드 마법진] [특수효과] MP:8",
        "마력폭발": "[HP] [마력] [폭발] MP:12",
        "마검의진리": "[궁극] [마검완성] [진리] MP:25",
        
        # 연금술사
        "물질변환": "[물질변환] [연금술] MP:6",
        "독성폭탄": "[BRV] [독폭탄] [중독] MP:4",
        "회복포션": "[즉시회복] [포션] MP:5",
        "강화주사": "[전능력+15%] [강화제] MP:6",
        "산성용해": "[HP] [산성] [용해] MP:10",
        "철학자의돌": "[궁극] [기적창조] [현자의돌] MP:28",
        
        # 기계공학자
        "자동포탑설치": "[자동공격포탑] [설치] MP:8",
        "레이저사격": "[BRV] [레이저] [정밀] MP:5",
        "메카돔": "[전체방어막] [기계돔] MP:7",
        "멀티미사일": "[HP] [다중미사일] [폭발] MP:12",
        "수리드론": "[자동치유] [드론] MP:8",
        "기가포탑": "[궁극] [초거대포탑] [압도화력] MP:30",
        
        # 네크로맨서
        "언데드소환": "[언데드소환] [지원] MP:8",
        "생명력흡수": "[BRV] [생명흡수] [어둠] MP:4",
        "공포주입": "[공포] [능력감소] MP:5",
        "뼈감옥": "[행동봉인] [뼈감옥] MP:7",
        "죽음의손길": "[HP] [죽음] [치명] MP:12",
    }
    
    # 스킬 설명 업데이트
    changes_made = 0
    
    for skill_name, tags in skill_tag_mapping.items():
        # 현재 설명을 찾아서 태그로 교체
        # 패턴: "description": "현재설명",
        pattern = rf'"description": "[^"]*{re.escape(skill_name)}[^"]*",'
        
        # 새로운 설명: 태그 + 기본 설명
        new_description = f'"description": "{tags} - {skill_name}",'
        
        if re.search(pattern, content):
            content = re.sub(pattern, new_description, content)
            changes_made += 1
            print(f"   태그 적용 {changes_made}: {skill_name} -> {tags}")
    
    # 파일 저장
    with open(file_path, 'w', encoding='utf-8') as f:
        f.write(content)
    
    print(f"\n🎉 총 {changes_made}개 스킬에 정확한 효과 태그 적용 완료!")
    return True

if __name__ == "__main__":
    print("=== 스킬 효과 태그 시스템 생성 ===")
    create_skill_tags_system()
