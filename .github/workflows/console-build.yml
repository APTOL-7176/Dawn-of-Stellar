name: ğŸš€ Dawn Of Stellar v3.0.0 - ì½˜ì†” ê²Œì„ ìë™ ë¹Œë“œ

on:
  push:
    branches: [ master, main ]
    tags: [ 'v*' ]
  pull_request:
    branches: [ master, main ]
  workflow_dispatch:

jobs:
  test:
    name: ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹¤í–‰
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ ì†ŒìŠ¤ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
      
    - name: ğŸ Python 3.10 ì„¤ì •
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: ğŸ” ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
      run: |
        echo "Testing core game modules..."
        python -c "import game.brave_combat; print('âœ… ì „íˆ¬ ì‹œìŠ¤í…œ ë¡œë“œ ì„±ê³µ')" || echo "âŒ ì „íˆ¬ ì‹œìŠ¤í…œ ë¡œë“œ ì‹¤íŒ¨"
        python -c "import game.character; print('âœ… ìºë¦­í„° ì‹œìŠ¤í…œ ë¡œë“œ ì„±ê³µ')" || echo "âŒ ìºë¦­í„° ì‹œìŠ¤í…œ ë¡œë“œ ì‹¤íŒ¨"
        python -c "import game.world; print('âœ… ì›”ë“œ ì‹œìŠ¤í…œ ë¡œë“œ ì„±ê³µ')" || echo "âŒ ì›”ë“œ ì‹œìŠ¤í…œ ë¡œë“œ ì‹¤íŒ¨"
        python -c "import config; print('âœ… ì„¤ì • ì‹œìŠ¤í…œ ë¡œë“œ ì„±ê³µ')" || echo "âŒ ì„¤ì • ì‹œìŠ¤í…œ ë¡œë“œ ì‹¤íŒ¨"

  build-windows:
    name: ğŸ—ï¸ Windows ì½˜ì†” ë¹Œë“œ
    runs-on: windows-latest
    needs: test
    
    steps:
    - name: ğŸ“¥ ì†ŒìŠ¤ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
      
    - name: ğŸ Python 3.10 ì„¤ì •
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller
        
    - name: ğŸ® ì½˜ì†” ê²Œì„ ë¹Œë“œ
      run: |
        echo "ğŸ”¨ PyInstaller ë¹Œë“œ ì‹œì‘..."
        mkdir -p sounds/bgm sounds/sfx
        echo "# Audio placeholder" > sounds/README.txt
        pyinstaller --console \
          --name "DawnOfStellar_v3.0.0_Console" \
          --icon=dos.png \
          --add-data "sounds;sounds" \
          --add-data "game;game" \
          --hidden-import=game.brave_combat \
          --hidden-import=game.character \
          --hidden-import=game.world \
          --hidden-import=game.items \
          --hidden-import=game.cooking_system \
          --hidden-import=game.ai_game_mode \
          --hidden-import=pygame \
          --collect-submodules game \
          --distpath dist/windows \
          main.py || echo "âš ï¸ ë¹Œë“œ ê²½ê³ ê°€ ìˆì„ ìˆ˜ ìˆì§€ë§Œ ê³„ì† ì§„í–‰í•©ë‹ˆë‹¤"
        
    - name: ğŸ“‹ ëŸ°ì²˜ íŒŒì¼ ë³µì‚¬
      run: |
        echo "ğŸ“‹ ì¶”ê°€ íŒŒì¼ ë³µì‚¬ ì¤‘..."
        copy "íŒŒì´ì¬ëŸ°ì²˜ì‹¤í–‰.bat" "dist/windows/" 2>nul || echo "ëŸ°ì²˜ íŒŒì¼ ì—†ìŒ, ê±´ë„ˆëœ€"
        copy "README.md" "dist/windows/" 2>nul || echo "README íŒŒì¼ ì—†ìŒ, ê±´ë„ˆëœ€"
        copy "requirements.txt" "dist/windows/" 2>nul || echo "requirements íŒŒì¼ ì—†ìŒ, ê±´ë„ˆëœ€"
        echo "ğŸ“ ì‹¤í–‰ ê°€ì´ë“œ ìƒì„±..."
        echo "# Dawn Of Stellar v3.0.0 ì‹¤í–‰ ê°€ì´ë“œ" > "dist/windows/ì‹¤í–‰ë°©ë²•.txt"
        echo "" >> "dist/windows/ì‹¤í–‰ë°©ë²•.txt"
        echo "1. DawnOfStellar_v3.0.0_Console.exe ë”ë¸”í´ë¦­" >> "dist/windows/ì‹¤í–‰ë°©ë²•.txt"
        echo "2. ì½˜ì†” ì°½ì—ì„œ ê²Œì„ ì‹¤í–‰" >> "dist/windows/ì‹¤í–‰ë°©ë²•.txt"
        echo "3. ë¬¸ì œ ë°œìƒ ì‹œ GitHub Issuesì— ì‹ ê³ " >> "dist/windows/ì‹¤í–‰ë°©ë²•.txt"
        
    - name: ğŸ“¤ Windows ë¹Œë“œ ì—…ë¡œë“œ
      uses: actions/upload-artifact@v3
      with:
        name: DawnOfStellar-v3.0.0-Windows-Console
        path: dist/windows/
        
  build-portable:
    name: ğŸ“¦ í¬í„°ë¸” ë°°í¬íŒ ìƒì„±
    runs-on: windows-latest
    needs: build-windows
    
    steps:
    - name: ğŸ“¥ ì†ŒìŠ¤ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
      
    - name: ğŸ“¥ Windows ë¹Œë“œ ë‹¤ìš´ë¡œë“œ
      uses: actions/download-artifact@v3
      with:
        name: DawnOfStellar-v3.0.0-Windows-Console
        path: portable/
        
    - name: ğŸ“¦ í¬í„°ë¸” íŒ¨í‚¤ì§€ ìƒì„±
      run: |
        cd portable
        echo "ğŸŒŸ Dawn Of Stellar v3.0.0 - í¬í„°ë¸” ë²„ì „" > INFO.txt
        echo "================================" >> INFO.txt
        echo "" >> INFO.txt
        echo "ğŸ“‹ ì‹¤í–‰ ë°©ë²•:" >> INFO.txt
        echo "1. ëŸ°ì²˜ì‹¤í–‰.bat ë”ë¸”í´ë¦­" >> INFO.txt
        echo "2. ì›í•˜ëŠ” ëª¨ë“œ ì„ íƒ" >> INFO.txt
        echo "3. ê²Œì„ í”Œë ˆì´!" >> INFO.txt
        echo "" >> INFO.txt
        echo "ğŸ® ì¡°ì‘ë²•:" >> INFO.txt
        echo "- í‚¤ë³´ë“œë¡œ ì¡°ì‘" >> INFO.txt
        echo "- ë©”ë‰´ì—ì„œ ìˆ«ìí‚¤ë¡œ ì„ íƒ" >> INFO.txt
        echo "- ESCë¡œ ì´ì „ ë©”ë‰´" >> INFO.txt
        echo "" >> INFO.txt
        echo "ğŸ“± ëª¨ë°”ì¼ ì•±ë„ ì§€ì›í•©ë‹ˆë‹¤!" >> INFO.txt
        
    - name: ğŸ—œï¸ ZIP ì••ì¶•
      run: |
        powershell Compress-Archive -Path "portable/*" -DestinationPath "DawnOfStellar-v3.0.0-Portable.zip"
        
    - name: ğŸ“¤ í¬í„°ë¸” ë°°í¬íŒ ì—…ë¡œë“œ
      uses: actions/upload-artifact@v3
      with:
        name: DawnOfStellar-v3.0.0-Portable-Release
        path: DawnOfStellar-v3.0.0-Portable.zip

  release:
    name: ğŸ‰ ë¦´ë¦¬ì¦ˆ ìƒì„±
    runs-on: ubuntu-latest
    needs: [build-windows, build-portable]
    if: startsWith(github.ref, 'refs/tags/')
    
    steps:
    - name: ğŸ“¥ ëª¨ë“  ì•„í‹°íŒ©íŠ¸ ë‹¤ìš´ë¡œë“œ
      uses: actions/download-artifact@v3
      
    - name: ğŸ‰ GitHub ë¦´ë¦¬ì¦ˆ ìƒì„±
      uses: softprops/action-gh-release@v1
      with:
        files: |
          DawnOfStellar-v3.0.0-Portable-Release/DawnOfStellar-v3.0.0-Portable.zip
        body: |
          # ğŸŒŸ Dawn Of Stellar v3.0.0 - ì •ì‹ ë¦´ë¦¬ì¦ˆ
          
          ## ğŸ® ì£¼ìš” íŠ¹ì§•
          - âœ… ì™„ì „í•œ ì½˜ì†” ê¸°ë°˜ ê²Œì„í”Œë ˆì´
          - âœ… Final Fantasy ìŠ¤íƒ€ì¼ Brave ì „íˆ¬ ì‹œìŠ¤í…œ
          - âœ… 28ê°œ ê³ ìœ  ì§ì—…êµ°
          - âœ… ë©”íƒ€ ì§„í–‰ ì‹œìŠ¤í…œ
          - âœ… ì›í´ë¦­ ì‹¤í–‰ ê°€ëŠ¥
          
          ## ğŸ“¥ ì„¤ì¹˜ ë°©ë²•
          1. `DawnOfStellar-v3.0.0-Portable.zip` ë‹¤ìš´ë¡œë“œ
          2. ì••ì¶• í•´ì œ
          3. `ëŸ°ì²˜ì‹¤í–‰.bat` ì‹¤í–‰
          4. ê²Œì„ í”Œë ˆì´!
          
          ## ğŸ¯ ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­
          - Windows 10 ì´ìƒ
          - ì½˜ì†”/í„°ë¯¸ë„ ì§€ì›
          - í‚¤ë³´ë“œ ì…ë ¥
          
          ì¦ê±°ìš´ ê²Œì„ í”Œë ˆì´ ë˜ì„¸ìš”! ğŸš€
        name: Dawn Of Stellar v3.0.0 - Console Edition
        tag_name: ${{ github.ref }}
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
