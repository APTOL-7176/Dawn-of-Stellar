# Copilot Instructions for Dawn of Stellar - Complete Game Documentation

<!-- Use this file to provide workspace-specific custom instructions to Copilot. For more details, visit https://code.visualstudio.com/docs/copilot/copilot-customization#_use-a-githubcopilot-instructions-md-file -->

## 🌟 Project Overview: Dawn of Stellar
**완전체 Python 기반 로그라이크 RPG 게임 + Flutter 모바일 클라이언트 - 2025년 8월 8일 최신 업데이트**

### 🎯 Core Game Vision
- **장르**: 클래식 로그라이크 + 현대적 JRPG 요소 융합 + FF 브레이브 시스템
- **스타일**: ASCII/유니코드 문자 기반 그래픽 + 실시간 게이지 애니메이션
- **플랫폼**: Windows/Linux/Mac 크로스 플랫폼 + Android/iOS 모바일
- **언어**: Python 3.10+ (완전 한국어 지원) + Flutter (다트)
- **테마**: 모험 + 판타지 세계관 + 차원간 모험
- **마스코트**: 로-바트 (자랑스럽고 장난기 있는 톤)

### �️ Architecture
- **백엔드**: Python 기반 게임 엔진 서버
- **프론트엔드**: Flutter 모바일 앱 (터미널 스타일 UI)
- **통신**: HTTP REST API + 실시간 상태 동기화
- **저장**: JSON 기반 세이브 시스템 + 클라우드 동기화

## 📱 Mobile Client (Flutter)
### UI/UX Design
- **터미널 테마**: 레트로 ASCII 스타일 모바일 적응
- **제스처 컨트롤**: 스와이프 기반 이동 (방향키 대체)
- **컨트롤 패널**: DraggableScrollableSheet 기반
- **입력 버튼**: 1-9 숫자키 + 확인/취소 + ESC
- **디바운싱**: 버튼 자동 연타 방지
- **아이콘**: "@" 심볼 로고

### Key Mappings
- **확인**: Enter ("\n")
- **취소**: Q 키
- **ESC**: FloatingActionButton
- **이동**: 스와이프 제스처 (상하좌우)
- **숫자**: 1-9 버튼 (메뉴 선택)

### Technical Implementation
- **main.dart**: Flutter 앱 메인 엔트리
- **HTTP 클라이언트**: 백엔드 API 통신
- **RichText**: 컬러 텍스트 렌더링
- **ListView**: 스크롤 가능한 게임 출력
- **TextField**: 명령 입력

##  Complete Game Systems

### 1. 🏰 던전 시스템 (Dungeon System)
- **던전 생성**: 절차적 생성 알고리즘
- **던전 타입**: 일반, 특수, 보스, 히든 던전
- **층수 시스템**: 무한 층수 진행 (100층까지 구현)
- **미니맵**: 실시간 탐험 지도
- **함정 시스템**: 독, 폭발, 순간이동 함정
- **보물상자**: 일반, 마법, 전설 등급 상자
- **환경 상호작용**: 문, 레버, 비밀통로

### 2. ⚔️ 브레이브 전투 시스템 (Brave Combat System)
#### ATB (Active Time Battle) 시스템 - 2025.08.08 수정
- **게이지 시스템**: 0~2000 범위 (ATB_MAX=2000)
- **행동 임계값**: 1000 (ATB_READY_THRESHOLD=1000)
- **속도 기반**: 캐릭터 속도에 따른 ATB 증가
- **증가량**: 기본 50 기반 (속도에 따라 25~100)
- **행동 비용**: 행동 후 ATB 1000 차감
- **캐스팅 시스템**: 스킬별 시전 시간 + 중단 가능
- **공정성**: get_action_order()로 단일 우선순위 기반 선택

#### ATB 문제 해결 내역 (2025.08.08)
- **player_turn 수정**: 캐스팅 중이거나 행동하지 않은 경우 ATB 차감 방지
- **battle_loop 개선**: 실제 행동한 경우에만 action_cost=1000 차감
- **casting 완료**: 캐스팅 완료 시에만 cast_time만큼 ATB 차감
- **BREAK 처리**: BREAK 상태에서만 ATB 0 리셋
- **우선순위**: ATB 게이지 > 속도 > 랜덤 순으로 공정한 선택

#### Brave Point 시스템 (FF 스타일)
- **BRV 축적**: Brave 공격으로 포인트 획득
- **HP 공격**: BRV 소모하여 실제 피해
- **BREAK 시스템**: BRV 0일 때 무력화 상태
- **INT BRV**: 턴 시작 시 기본 BRV 회복
- **BRV 보정**: 직업별/장비별 BRV 보너스

#### 상처 시스템 (Wound System)
- **상처 축적**: 받은 피해의 25%가 상처로 누적
- **최대 상처**: 최대 HP의 75%까지 제한
- **상처 치유**: 초과 회복의 25%로 상처 치료
- **영구 피해**: 상처는 전투 종료 후에도 지속

#### 통합 데미지 시스템 (Unified Damage System)
- **물리/마법 피해**: 방어력 계산 통합
- **크리티컬 시스템**: 직업별 크리티컬 보정
- **상성 시스템**: 직업간 상성 보너스/페널티
- **저항/약점**: 원소별 저항/약점 시스템

### 3. 👥 파티 관리 시스템 (Party Management)
- **파티 크기**: 최대 4명 구성
- **직업 시스템**: 28개 고유 직업 (2025년 업데이트)
- **동료 시스템**: NPC 동료 영입
- **AI 동료**: 자동 전투 AI 탑재
- **파티 밸런스**: 탱커, 딜러, 힐러, 서포터 역할 분담
- **협력 스킬**: 파티원 간 연계 공격

### 4. 🎓 직업 시스템 (Character Classes) - 28개 직업
#### 전투 직업군 (8개)
- **전사**: 적응형 방패 강타, 파괴의 일격
- **아크메이지**: 마력 파동, 마력 폭발
- **궁수**: 삼연사, 관통사격 + 지원사격 시스템
- **도적**: 독침, 암살 + 맹독 시스템
- **성기사**: 성스러운 타격, 심판의 빛
- **암흑기사**: 흡혈 베기, 흡혈 강타
- **몽크**: 연환 타격, 폭렬권 + 표식 시스템
- **바드**: 음파 공격, 영혼의 노래 + 사기 시스템

#### 마법 직업군 (10개)
- **네크로맨서**: 생명력 흡수, 영혼 흡수
- **용기사**: 화염 강타, 드래곤 브레스
- **검성**: 검기 베기, 일섬
- **정령술사**: 원소 탄환, 원소 융합
- **시간술사**: 시간 조작, 시간 정지
- **연금술사**: 화학 폭발, 대폭발 반응
- **차원술사**: 차원 균열, 차원 붕괴
- **마검사**: 마법검기, 마검 오의
- **기계공학자**: 레이저 사격, 메가 레이저 (수정됨)
- **무당**: 영혼 타격, 영혼 분리 (밸런스 수정)

#### 특수 직업군 (10개)
- **암살자**: 그림자 강타, 그림자 처형 + 그림자 시스템
- **해적**: 이도류 난타, 해적의 보물
- **사무라이**: 거합 베기, 무사도 비의
- **드루이드**: 자연의 분노, 자연의 심판
- **철학자**: 논리적 반박, 진리의 깨달음
- **검투사**: 투기장 기술, 검투장의 피날레
- **기사**: 창 돌격, 성스러운 돌격
- **신관**: 축복의 빛, 신의 심판
- **광전사**: 광폭화 난타, 최후의 광기

### 5. ✨ 스킬 시스템 (New Skill System) - 2025년 완전 개편
#### 스킬 타입
- **BRV_ATTACK**: Brave 포인트 획득 공격 (기본 공격)
- **HP_ATTACK**: 직접 HP 피해 공격 (기본 공격)
- **BRV_HP_ATTACK**: BRV 획득 + HP 피해 복합
- **ULTIMATE**: 궁극기 (높은 MP 소모)
- **SUPPORT**: 지원/회복 스킬
- **DEBUFF**: 적 약화 스킬

#### 스킬 데이터베이스 구조
```python
# 각 직업별 기본 공격 2개 (MP 0)
{"name": "기계타격", "mp_cost": 0, "type": SkillType.BRV_ATTACK}
{"name": "에너지방출", "mp_cost": 0, "type": SkillType.HP_ATTACK}

# 전술 스킬들 (MP 소모)
{"name": "자기장_조작", "mp_cost": 12, "type": SkillType.SUPPORT}
```

#### 캐스팅 시스템
- **캐스트 타임**: 스킬별 시전 시간 (0.5초~3초)
- **중단 가능**: 피해 받으면 캐스팅 중단
- **ATB 연동**: 캐스팅 중 ATB 게이지 표시
- **즉시 시전**: MP 0 기본 공격은 즉시 실행

#### 특수 스킬 시스템
- **기계공학자**: 장비 조작 스킬 (적용 범위 수정)
- **바드**: 음표 중첩 방지 시스템
- **무당**: 영혼 스킬 밸런스 조정
- **도적**: 맹독 시스템 + 독 촉진
- **궁수**: 조준 포인트 + 지원사격
- **암살자**: 그림자 시스템 연동

### 6. 🎒 인벤토리 & 아이템 시스템
#### 아이템 카테고리
- **소모품**: 회복 포션, 버프 아이템
- **장비**: 무기, 방어구, 액세서리
- **재료**: 제작 재료, 강화 석
- **귀중품**: 퀘스트 아이템, 수집품

#### 장비 시스템 (Equipment System) - 2025.08.08 수정
- **확장 장비 클래스**: Equipment 클래스 기반
- **내구도 시스템**: 사용에 따른 내구도 감소
- **특수 효과**: EquipmentEffect 클래스
- **세트 장비**: 세트 효과 시스템
- **원소 저항**: ElementType 기반 저항/약점
- **인벤토리 연동**: 장착/해제 시 인벤토리 자동 관리
- **중복 방지**: equip_item 메서드 단일화로 아이템 소실 방지

#### 제작 시스템 (Crafting)
- **요리 시스템**: 음식 제작으로 버프 효과
- **연금술**: 포션 및 특수 아이템 제작
- **강화 시스템**: 장비 강화 및 인챈트

### 7. 🧬 특성 시스템 (Trait System)
#### 특성 타입
- **패시브 특성**: 항상 활성화된 효과
- **액티브 특성**: 수동 발동 특성
- **전투 특성**: 전투 중 자동 발동
- **조건부 특성**: 특정 조건에서 발동

#### 특성 예시
- **동물 변신**: 늑대/곰/독수리 형태 변환
- **원소 친화**: 원소 마법 위력 증가
- **전투 광**: 체력 낮을수록 공격력 증가
- **치유술사**: 회복 효과 2배 증가

### 8. 🤖 AI 시스템 (AI Game Mode)
#### AI 동료 시스템
- **자동 전투**: AI가 최적 행동 선택
- **전략적 판단**: 상황 분석 후 행동 결정
- **협력 플레이**: 플레이어와 협력 전술
- **학습 능력**: 플레이 패턴 학습 및 적응

#### AI 행동 패턴
- **공격**: 최적 타겟 선택 (직업별 전략)
- **스킬**: 상황별 스킬 사용 (MP 0 기본 공격 포함)
- **방어**: 위험 상황 시 방어
- **치료**: 아군 체력 관리
- **아이템**: 필요 시 아이템 사용
- **요청**: 플레이어에게 지시 요청

#### 전술적 AI 우선순위
- **emergency_heal**: 응급 치료 (HP 20% 이하)
- **support_heal**: 지원 치료 (파티 HP 60% 이하)
- **ultimate_attack**: 궁극기 사용 (MP 20 이상)
- **tactical_skill**: 전술 스킬 (MP 12 이상)
- **hp_attack**: HP 공격 (BRV 400 이상)
- **brv_attack**: BRV 공격 (기본 행동)

### 9. 🎵 오디오 시스템 (Audio System)
#### BGM 시스템
- **상황별 BGM**: 던전, 전투, 마을, 보스
- **동적 전환**: 상황에 따른 자연스러운 전환
- **루프 재생**: 끊김 없는 배경음악
- **BGMType enum**: DUNGEON, BATTLE, BOSS, VICTORY 등

#### SFX 시스템
- **전투음**: 공격, 스킬, 방어음
- **환경음**: 발걸음, 문 여는 소리
- **UI음**: 메뉴, 선택, 확인음
- **스킬별 SFX**: 각 스킬마다 고유 효과음

### 10. 💾 저장 시스템 (Save System)
#### 저장 데이터
- **캐릭터 진행도**: 레벨, 경험치, 스탯
- **인벤토리**: 아이템, 장비, 돈
- **던전 진행**: 탐험한 층수, 맵 정보
- **퀘스트**: 진행 중/완료된 퀘스트
- **설정**: 게임 설정, 키 바인딩

#### 자동 저장
- **던전 진입**: 새 층 진입 시 자동 저장
- **전투 승리**: 중요 전투 후 자동 저장
- **상점 이용**: 거래 완료 후 자동 저장

### 11. 🎯 난이도 시스템 (Difficulty System)
- **쉬움**: 초보자용 (피해 -30%, 경험치 +20%)
- **보통**: 표준 난이도
- **어려움**: 도전적 (피해 +50%, 경험치 +50%)
- **지옥**: 극한 도전 (피해 +100%, 특수 보상)

### 12. 🏆 업적 시스템 (Achievement System)
- **전투 업적**: 연속 승리, 완벽한 승리
- **탐험 업적**: 층수 도달, 비밀 발견
- **수집 업적**: 아이템 수집, 도감 완성
- **특수 업적**: 숨겨진 조건 달성

### 13. 🎮 UI/UX 시스템 (Interface Systems)
#### 애니메이션 시스템
- **게이지 애니메이션**: HP/MP/BRV/ATB 실시간 애니메이션
- **SequentialGaugeAnimator**: 순차적 게이지 처리
- **BufferedDisplay**: 화면 깜빡임 방지
- **부드러운 전환**: easeInOutQuad 곡선 적용

#### 입력 시스템
- **CursorMenu**: 커서 기반 메뉴 시스템
- **KeyboardInput**: 키보드 입력 처리
- **HotkeySystem**: 단축키 시스템
- **InputBuffer**: 입력 버퍼 관리

#### 표시 시스템
- **ColorSystem**: 256색 컬러 시스템
- **GameDisplay**: 게임 화면 렌더링
- **StatusDisplay**: 실시간 상태 표시
- **CombatVisualizer**: 전투 시각 효과

### 14. 🛡️ 장비 관리 시스템 (Equipment Management)
#### AI 자동 장착 시스템
- **BasicEquipmentManager**: 자동 장비 최적화
- **안전한 장착**: 아이템 소실 방지 시스템
- **인벤토리 연동**: 장착/해제 시 인벤토리 동기화
- **보너스 적용**: 장비 효과 자동 계산

#### 장비 효과 시스템
- **스탯 보너스**: 기본 능력치 증가
- **특수 효과**: SpecialEffect enum 기반
- **세트 효과**: 같은 세트 장비 착용 시 추가 효과
- **내구도 관리**: 사용에 따른 내구도 감소 및 수리

### 15. 🌑 특수 메커니즘 시스템
#### 그림자 시스템 (암살자 전용)
- **그림자 생성**: 공격 시 그림자 소환
- **그림자 메아리**: 추가 피해 효과
- **그림자 처형**: 모든 그림자 소모 강력한 일격

#### 맹독 시스템 (도적 전용)
- **독 중첩**: 최대 96스택까지 독 누적
- **독 촉진**: HP 공격 시 독 피해 즉시 적용
- **독 면역**: 특정 조건에서 독 면역 획득

#### 조준 시스템 (궁수 전용)
- **조준 포인트**: 공격마다 조준 정확도 증가
- **지원사격**: 턴 종료 시 추가 공격
- **관통 공격**: 여러 적에게 동시 피해

### 16. 🔧 최근 수정사항 (2025년 8월 8일)
#### 주요 수정 내역
1. **ATB 시스템 완전 수정**
   - player_turn에서 캐스팅 중이거나 행동하지 않은 경우 ATB 차감 방지
   - battle_loop에서 실제 행동한 경우에만 action_cost=1000 차감
   - get_action_order()로 공정한 우선순위 기반 턴 선택
   - 아군 턴 누락 문제 해결 완료

2. **장비 시스템 안정화**
   - 중복된 equip_item 메서드 제거
   - 인벤토리 연동 equip_item만 사용하여 아이템 소실 방지
   - 장착/해제 시 인벤토리 자동 동기화
   - 저장/로드 시 장비와 인벤토리 일치성 보장

3. **Flutter 모바일 클라이언트 완성**
   - 제스처 기반 이동 (스와이프)
   - DraggableScrollableSheet 컨트롤 패널
   - 입력 디바운싱 및 자동 연타 방지
   - 터미널 스타일 UI + "@" 로고
   - 확인(Enter), 취소(Q), ESC(FAB) 매핑

4. **AI 시스템 최적화**
   - AI 모드 기본 비활성화로 아군 직접 제어
   - 전술적 우선순위 시스템 완성
   - MP 0 기본 공격 포함 AI 로직
   - 캐릭터별 특성 기반 AI 전술

#### 해결된 버그들
- ✅ 아군 ATB 가득 차도 턴이 안 오는 문제
- ✅ 장비 로드 시 인벤토리에서 사라지는 문제
- ✅ Flutter 무한 높이 DraggableScrollableSheet 에러
- ✅ 버튼 자동 연타 문제
- ✅ AI가 기본 공격을 사용하지 않는 문제

#### 현재 상태 (2025.08.08)
- **ATB 시스템**: 완전 작동, 공정한 턴 분배
- **장비 시스템**: 안정적 인벤토리 연동
- **모바일 클라이언트**: 완성된 UI/UX
- **AI 시스템**: 최적화된 전투 AI
- **저장 시스템**: 무결성 보장

## 🛠️ Technical Architecture

### Core Modules
```python
main.py                 # 게임 메인 엔트리 포인트
config.py              # 게임 설정 관리
game/
├── brave_combat.py    # 전투 시스템 핵심
├── character.py       # 캐릭터 클래스
├── party_manager.py   # 파티 관리
├── dungeon_system.py  # 던전 생성/관리
├── skill_system.py    # 스킬 데이터베이스
├── item_system.py     # 아이템 관리
├── ai_game_mode.py    # AI 시스템
├── trait_system.py    # 특성 시스템
├── audio_system.py    # 오디오 관리
└── save_system.py     # 저장/로드
```

### 🎨 UI/UX Systems
#### Display Systems
- **BufferedDisplay**: 화면 깜빡임 방지
- **ColorSystem**: 256색 컬러 시스템
- **CursorMenu**: 커서 기반 메뉴
- **GameDisplay**: 게임 화면 렌더링

#### Input Systems
- **KeyboardInput**: 키보드 입력 처리
- **MenuNavigation**: 메뉴 탐색 시스템
- **HotkeySystem**: 단축키 시스템

### 🔧 Utility Systems
- **GameStateEncoder**: JSON 직렬화
- **ErrorHandler**: 예외 처리
- **PerformanceMonitor**: 성능 모니터링
- **DebugSystem**: 디버그 기능

## 📊 Game Balance & Mechanics

### Damage Formula
```python
기본_피해 = (공격력 / 방어력) * 스킬_배율
최종_피해 = 기본_피해 * 특성_배율 * 상태_배율
BRV_피해 = 최종_피해 * BRV_배율
HP_피해 = BRV_포인트 * HP_배율
```

### Status Effects
- **독**: 턴마다 HP 감소
- **화상**: 행동 시 추가 피해
- **빙결**: 행동 불가
- **마비**: 확률적 행동 실패
- **축복**: 모든 능력치 증가
- **저주**: 모든 능력치 감소

### Critical System
- **크리티컬 확률**: 기본 5% + 운 스탯
- **크리티컬 배율**: 1.5배 ~ 2.0배
- **크리티컬 효과**: 추가 상태이상 부여

## 🎮 Code Style Guidelines

### Naming Conventions
- **변수명**: snake_case (한글 주석 포함)
- **클래스명**: PascalCase
- **함수명**: snake_case
- **상수명**: UPPER_SNAKE_CASE

### Design Patterns
- **Singleton**: 게임 매니저 클래스들
- **Factory**: 캐릭터/아이템 생성
- **Observer**: 이벤트 시스템
- **Strategy**: AI 행동 패턴
- **Command**: 액션 시스템

### Error Handling
```python
try:
    # 게임 로직
    result = perform_action()
except GameException as e:
    # 게임 내 예외 처리
    handle_game_error(e)
except Exception as e:
    # 시스템 예외 처리
    log_error(e)
    show_error_dialog()
```

## 🚀 Performance Optimization

### Memory Management
- **객체 풀링**: 자주 생성되는 객체 재사용
- **지연 로딩**: 필요할 때만 리소스 로드
- **가비지 컬렉션**: 수동 메모리 정리

### Display Optimization
- **더블 버퍼링**: 화면 깜빡임 방지
- **부분 업데이트**: 변경된 부분만 다시 그리기
- **프레임 제한**: 60 FPS 제한

## 🐛 Debugging & Testing

### Debug Features
- **치트 모드**: 개발자 전용 치트
- **로그 시스템**: 상세 게임 로그
- **상태 확인**: 실시간 게임 상태 모니터링

### Testing Strategy
- **단위 테스트**: 개별 함수 테스트
- **통합 테스트**: 시스템 간 연동 테스트
- **플레이 테스트**: 실제 게임플레이 테스트

## 🔮 Future Expansion Plans

### Planned Features
- **멀티플레이어**: 온라인 협동/대전
- **모드 시스템**: 사용자 제작 콘텐츠
- **시즌 시스템**: 정기 업데이트 콘텐츠
- **토너먼트**: 경쟁 모드

### Technical Improvements
- **3D 그래픽**: 3D 모델 지원
- **음성 지원**: 캐릭터 음성
- **클라우드 저장**: 온라인 저장 시스템

## 🎯 Game Development Philosophy

### Core Principles
1. **플레이어 경험 우선**: 재미와 몰입감
2. **접근성**: 누구나 쉽게 시작
3. **깊이**: 마스터하기 어려운 깊이
4. **공정성**: 운보다는 실력 중심
5. **창의성**: 다양한 플레이 스타일 지원

### Quality Standards
- **버그 없는 게임**: 철저한 테스트
- **직관적 UI**: 쉬운 조작법
- **빠른 로딩**: 대기시간 최소화
- **안정적 성능**: 모든 환경에서 안정적

## 📝 Important Game Mechanics Notes

### Combat System
- BRV 공격은 적의 BRV를 감소시키고 자신의 BRV 증가
- HP 공격은 자신의 BRV를 소모하여 적의 HP 감소
- BREAK 상태의 적은 다음 턴까지 행동 불가
- 상처 시스템으로 단순 회복만으로는 완전 회복 불가

### Character Progression
- 레벨업 시 스탯 자동 증가
- 직업별 고유 스킬 트리
- 특성 시스템으로 개성화
- 장비를 통한 추가 스탯 보정

### Resource Management
- HP: 생명력 (0이 되면 전투불능)
- MP: 마법력 (스킬 사용에 소모)
- BRV: 용기 (HP 공격의 위력 결정)
- 스태미나: 던전 탐험 시 소모

### Strategic Depth
- 직업 조합에 따른 시너지 효과
- 적의 약점/저항 시스템
- 전장 위치에 따른 전략 변화
- 시간 관리 (ATB 게이지 활용)

이 게임은 단순한 로그라이크를 넘어서 현대적 JRPG의 모든 요소를 담은 종합 RPG 시스템입니다!

### Character Progression
- 레벨업 시 스탯 자동 증가
- 직업별 고유 스킬 트리
- 특성 시스템으로 개성화
- 장비를 통한 추가 스탯 보정

### Resource Management
- HP: 생명력 (0이 되면 전투불능)
- MP: 마법력 (스킬 사용에 소모)
- BRV: 용기 (HP 공격의 위력 결정)
- 스태미나: 던전 탐험 시 소모

### Strategic Depth
- 직업 조합에 따른 시너지 효과
- 적의 약점/저항 시스템
- 전장 위치에 따른 전략 변화
- 시간 관리 (ATB 게이지 활용)

이 게임은 단순한 로그라이크를 넘어서 현대적 JRPG의 모든 요소를 담은 종합 RPG 시스템입니다!
